<?xml version="1.0" encoding="UTF-8"?>
<mily-mappings package="com.haoyong.sales.sale.form">
	<import>net.sf.mily.support.form.*</import>
	<import>com.haoyong.sales.common.listener.*</import>
	<import>com.haoyong.sales.sale.domain.*</import>
	<import>com.haoyong.sales.sale.form.*</import>
	<import>com.haoyong.sales.base.domain.*</import>
	<import>com.haoyong.sales.base.form.*</import>
	<class name="OrderTicketForm" label="订单">
		<property name="OrderTicket" visible="false" class="OrderTicket" builder="EditViewBuilder">
			<property name="Ticket" class="OrderTicket">
				<property name="number" label="订单号" builder="TextFieldBuilder">
					<param name="cfg">
						<attribute name="type" value="Require" />
					</param>
					<param name="button">
						<attribute name="text" value="生成单号" />
						<param name="listener">
							<attribute name="class" value="ChangeAssociateListener" />
							<attribute name="method" value="setOrderNumberNew" />
							<attribute name="properties" value="number" />
						</param>
					</param>
				</property>
				<property name="number2" label="人工订单号" builder="TextFieldBuilder" />
				<property name="orderType" label="订单类型" builder="TextBuilder">
					<param name="cfg">
						<attribute name="type" value="Require" />
					</param>
				</property>
				<property name="orderDate" label="订单日期" builder="DateBuilder" />
				<property name="hopeDate" label="交货日期" builder="DateBuilder" />
				<property name="createUser" label="下单人员" builder="TextFieldBuilder" />
				<property name="supportMan" label="客服人员" builder="TextFieldBuilder" />
				<property name="Project" class="OrderTicket">
					<property name="proNumber" label="项目编号" builder="TextFieldBuilder" >
						<param name="listener">
							<attribute name="class" value="ChangeAssociateListener" />
							<attribute name="properties" value="OrderTicket.Ticket" />
							<attribute name="getter" value="getProjectSearchNumber" />
						</param>
						<param name="listener">
							<attribute name="class" value="SimpleDialogOpenListener" />
							<attribute name="view-name" value="ProjectQuery" />
							<attribute name="expression" value="isDialogOpen=true" />
						</param>
						<param name="button">
							<attribute name="text" value="生成编号" />
							<param name="listener">
								<attribute name="class" value="ChangeAssociateListener" />
								<attribute name="method" value="setProjectNumberNew" />
								<attribute name="properties" value="proNumber" />
							</param>
						</param>
						<param name="button">
							<attribute name="text" value="选择x" />
							<param name="listener">
								<attribute name="class" value="SimpleDialogOpenListener" />
								<attribute name="view-name" value="ProjectQuery" />
							</param>
						</param>
					</property>
					<property name="proName" label="项目名称" builder="TextFieldBuilder" />
					<property name="proType" label="项目类型" builder="TextFieldBuilder" />
					<property name="proOptions" label="工程内容" builder="TextFieldBuilder" />
					<property name="billUnit" label="开票单位" builder="TextFieldBuilder" />
					<property name="saleMan" label="业务人员" builder="TextFieldBuilder" />
					<property name="designMan" label="方案人员" builder="TextFieldBuilder" />
					<property name="province" label="省份" builder="TextFieldBuilder" />
					<property name="city" label="城市" builder="TextFieldBuilder" />
					<property name="area" label="区域" builder="TextFieldBuilder" />
					<property name="siteAmount" label="约有网点数" builder="TextFieldBuilder" />
				</property>
				<property name="locationTicket.out.name" label="出库仓" builder="TextFieldBuilder">
					<param name="listener">
						<attribute name="class" value="ChangeAssociateListener" />
						<attribute name="properties" value="locationTicket.out.name,locationTicket.to.name" />
						<attribute name="getter" value="getStorehouseSearchName" />
					</param>
					<param name="listener">
						<attribute name="class" value="SimpleDialogOpenListener" />
						<attribute name="view-name" value="StorehouseQuery" />
						<attribute name="expression" value="isDialogOpen=true" />
					</param>
					<param name="button">
						<attribute name="text" value="选择cc" />
						<param name="listener">
							<attribute name="class" value="SimpleDialogOpenListener" />
							<attribute name="view-name" value="StorehouseQuery" />
						</param>
					</param>
				</property>
				<property name="locationTicket.to.name" label="入库仓" builder="TextFieldBuilder" >
					<param name="listener">
						<attribute name="class" value="ChangeAssociateListener" />
						<attribute name="properties" value="locationTicket.out.name,locationTicket.to.name" />
						<attribute name="getter" value="getStorehouseSearchName" />
					</param>
					<param name="listener">
						<attribute name="class" value="SimpleDialogOpenListener" />
						<attribute name="view-name" value="StorehouseQuery" />
						<attribute name="expression" value="isDialogOpen=true" />
					</param>
					<param name="button">
						<attribute name="text" value="选择cr" />
						<param name="listener">
							<attribute name="class" value="SimpleDialogOpenListener" />
							<attribute name="view-name" value="StorehouseQuery" />
						</param>
					</param>
				</property>
				<property name="remark" label="下单备注" builder="TextAreaBuilder">
					<param name="cfg">
						<attribute name="position" value="row" />
					</param>
				</property>
			</property>
			<property name="Handle" class="OrderTicket">
	        	<property name="cprice" label="商品单价" builder="TextFieldBuilder"/>
	        	<property name="cmoney" label="商品合价" builder="TextFieldBuilder"/>
			</property>
			<property name="Detail" class="OrderTicket">
	        	<property name="XS" label="XS" builder="TextFieldBuilder"/>
	        	<property name="S" label="S" builder="TextFieldBuilder"/>
	        	<property name="M" label="M" builder="TextFieldBuilder"/>
	        	<property name="L" label="L" builder="TextFieldBuilder"/>
	        	<property name="XL" label="XL" builder="TextFieldBuilder"/>
	        	<property name="X2L" label="XXL" builder="TextFieldBuilder"/>
	        	<property name="X3L" label="XXXL" builder="TextFieldBuilder"/>
	        	<property name="weight" label="重量" builder="TextFieldBuilder">
					<param name="listener">
						<attribute name="class" value="SelectRowListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="ChangeAssociateListener" />
						<attribute name="properties" value="amount" />
						<attribute name="method" value="setAmountByWeight" />
					</param>
	        	</property>
	        	<property name="taxRate" label="税率%" builder="TextFieldBuilder">
					<param name="listener">
						<attribute name="class" value="SelectRowListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="ChangeAssociateListener" />
						<attribute name="properties" value="price,untaxPrice" />
						<attribute name="method" value="setTaxPrice" />
					</param>
	        	</property>
	        	<property name="untaxPrice" label="无税价" builder="TextFieldBuilder">
					<param name="listener">
						<attribute name="class" value="SelectRowListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="ChangeAssociateListener" />
						<attribute name="properties" value="price,untaxPrice" />
						<attribute name="method" value="setTaxPrice" />
					</param>
	        	</property>
	        	<property name="rowi" label="顺序号" builder="TextFieldBuilder"/>
	        	<property name="doption" label="明细选项" builder="CheckBoxGroupBuilder">
					<param name="options">
						<attribute name="collection" value="getOrderDOptions" />
						<attribute name="value-property" value="name" />
						<attribute name="text-property" value="name" />
					</param>
				</property>
	        	<property name="spnote" label="下单商品要求" builder="HtmlFieldBuilder"/>
			</property>
		</property>
		<view name="OrderType" label="订单类型" builder="EditViewBuilder">
			<property name="OrderTypeForm" class="OrderTypeForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="List"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
			<property name="OrderDoptionForm" class="OrderDoptionForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="List"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
		</view>
		<view name="TicketChoose" label="订单自选" builder="EditViewBuilder">
			<property name="ticketChooseFormer" Class="ChooseFormer" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="Ticket"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
			<property name="detailChooseFormer" Class="ChooseFormer" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="Ticket"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
		</view>
		<view name="PrintModel" label="打印模板" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="position" value="Independent"/>
			</param>
			<property name="PrintModelForm" Class="PrintModelForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="Model"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
		</view>
		<view name="Create" label="客户订单新增" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="before" value="beforeCreate4Client" />
			</param>
			<param name="menu">
				<attribute name="text" value="提交" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="setter" value="setDetailSupplyType" info="不显示SupplyType时，默认明细商品类型=采购" />
				</param>
				<param name="listener">
					<attribute name="class" value="ValidateListener" />
					<attribute name="setter" value="validateCreate" />
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<param name="action">
						<attribute name="action" value="OrderTicket_T" />
						<attribute name="setter" value="setTicket4Service" />
						<attribute name="message" value="保存订单单头" />
					</param>
					<param name="action">
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="setter" value="setCreate4Service" />
						<attribute name="message" value="新增订单生效，计算够用数量" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="新增订单" />
							<attribute name="method" value="setOrderState" />
						</param>
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="甲供已发货" />
							<attribute name="method" value="setSendState" />
							<attribute name="select" value="Commodity.supplyType='甲供'" />
						</param>
						<param name="user">
							<attribute name="method" value="setOrderUser" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="OrderTicket_Effect" />
						<attribute name="setter" value="setEffect4Service" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Count" />
						<attribute name="property" value="DetailList" />
						<attribute name="message" value="订单全单统计" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="RedirectorListener" />
					<attribute name="url" value="success.jsp" />
				</param>
			</param>
			<property name="domain" class="OrderDetail">
				<property name="OrderTicket.Ticket" class="OrderTicket" />
				<property name="client" class="Client" />
				<property name="subCompany" class="SubCompany" />
			</property>
			<property name="detailList" class="OrderDetail" builder="EditListBuilder">
				<param name="menu">
					<attribute name="text" value="添加明细" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="addDetail" />
					</param>
					<param name="listener">
						<attribute name="class" value="RefreshListener" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="导入明细" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="prepareImport" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="getImportFromBuilder" />
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="view-name" value="Import" />
						<attribute name="target" value="Create" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="移除明细" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDeleteListener" />
					</param>
				</param>
				<property name="commodity" class="Commodity" />
				<property name="amount" label="数量" builder="TextFieldBuilder" >
					<param name="validate">
						<attribute name="setter"><![CDATA[[{$OrderTicket.cmoney}]]]></attribute>
					</param>
				</property>
				<property name="OrderTicket.cprice" label="单价" builder="TextFieldBuilder" >
					<param name="validate">
						<attribute name="setter"><![CDATA[[{$OrderTicket.cmoney}]]]></attribute>
					</param>
				</property>
	        	<property name="OrderTicket.cmoney" label="商品合价" builder="TextFieldBuilder">
					<param name="validate">
						<attribute name="getter"><![CDATA[
var tprice={$OrderTicket.cprice}.svalue, tamount={$amount}.svalue;
if (tprice.length>0 && tamount.length>0) {
	this.value=eval(tprice) * eval(tamount);
} else {
	this.value=null;
}
this.onblur();
						]]></attribute>
					</param>
	        	</property>
				<property name="OrderTicket.Detail" class="OrderTicket" />
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
			</property>
		</view>
		<view name="Create4Back" label="备货订单新增" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="before" value="beforeCreate4Back" />
			</param>
			<property name="BOrderTicketForm" class="BOrderTicketForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="Create"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
			<property name="selectedList" class="OrderDetail" label="低于安全库存待备货" builder="SqlListBuilder">
				<param name="cfg">
					<attribute name="parameter" value="getParam4Enough"/>
				</param>
				<param name="remind">
					<attribute name="id" value="id" />
					<attribute name="value" value=">0" />
				</param>
				<param name="menu">
					<attribute name="text" value="添加入备货单明细" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
						<attribute name="former" value="selectFormer4Commodity" />
						<param name="parameter">
							<attribute name="id" value="enoughId" />
							<attribute name="version" value="enoughVersion" />
							<attribute name="class" value="StoreEnough" />
						</param>
						<param name="id">
							<attribute name="id" value="commId" />
							<attribute name="version" value="version" />
							<attribute name="class" value="Commodity" />
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="addDetail4Commodity" />
					</param>
					<param name="listener">
						<attribute name="class" value="RefreshListener" />
						<attribute name="view-name" value="Create4Back" />
					</param>
				</param>
				<fields>
					<field id="id" type="Long" label="选择" expression="p.ID" />
					<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
					<field id="enoughId" type="Long" label="够用ID" visible="false" expression="p.id" />
					<field id="commId" type="Long" label="商品ID" visible="false" expression="c.id" />
					<field id="commNumber" type="String" label="商品编号" expression="c.commNumber" />
					<field id="name" type="String" label="商品名称" expression="CONCAT_WS(',',p.commName,p.commOther)" />
					<field id="minInventory" type="Double" label="最低库存数" expression="c.minInventory" >
						<param name="footer">
							<attribute name="type" value="SUM" />
							<attribute name="expression" value="sum(c.minInventory)" />
						</param>
					</field>
					<field id="amount" type="Double" label="够用数量" expression="p.amount" />
					<field id="storeAmount" type="Double" label="库存数量" expression="p.storeAmount" >
						<param name="footer">
							<attribute name="type" value="SUM" />
							<attribute name="expression" value="sum(p.storeAmount)" />
						</param>
					</field>
					<field id="requestAmount" type="Double" label="请购数量" expression="p.requestAmount" >
						<param name="footer">
							<attribute name="type" value="SUM" />
							<attribute name="expression" value="sum(p.requestAmount)" />
						</param>
					</field>
					<field id="onroadAmount" type="Double" label="在途数量" expression="p.onroadAmount" >
						<param name="footer">
							<attribute name="type" value="SUM" />
							<attribute name="expression" value="sum(p.onroadAmount)" />
						</param>
					</field>
					<field id="supplyType" type="String" label="供货方式" expression="c.supplyType" />
					<field id="modifytime" type="DateTime" label="编辑时间" expression="p.modifytime" />
					<field id="version" type="int" label="商品版本" visible="false" expression="c.version" />
					<field id="enoughVersion" type="int" label="够用版本" visible="false" expression="p.version" />
				</fields>
				<DataSource><![CDATA[
					from sa_StoreEnough p
					join bs_commodity c on p.sellerId=c.sellerId and p.commNumber=c.commNumber and p.instore is null
				]]>
				</DataSource>
				<Where><![CDATA[
					0<c.minInventory and (p.storeAmount+p.requestAmount+p.onroadAmount)<c.minInventory and {$limitCommName}
				]]>
				</Where>
			</property>
		</view>
		<view name="ShowQuery" label0="订单查询" builder="EditViewBuilder">
			<property name="selfForm" class="OrderTicketForm" builder="TabPaneBuilder">
				<property name="TicketForm" label="本级订单" class="OrderTicketForm" builder="EditViewBuilder">
					<param name="menu">
						<attribute name="text" value="查看" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4OrderTicket" />
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="setter" value="getDetailsOfTicket" />
						</param>
					</param>
					<param name="menu">
						<attribute name="text" value="选择OrderTicket" />
						<attribute name="image" value="mily/img/color.gif" />
						<attribute name="show" value="false" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4OrderTicket" />
						</param>
					</param>
					<property name="selectedList" class="OrderTicket" builder="SqlListBuilder">
						<param name="cfg">
							<attribute name="select" value="Single" />
						</param>
						<fields>
							<field id="id" type="Long" label="选择" expression="t.id" />
							<field id="SellerId" type="Long" label="商家ID" visible="false" expression="t.sellerId" />
							<field id="number" type="String" label="订单号" expression="t.number" />
							<field id="number2" type="String" label="人工订单号" expression="t.number2" />
							<field id="orderType" type="String" label="订单类型" expression="t.orderType" />
							<field id="orderDate" type="Date" label="订单日期" expression="t.orderDate" />
							<field id="hopeDate" type="Date" label="期望出货日期" expression="t.hopeDate" />
							<field id="OrderT" type="String" label="订单合计" expression="t.OrderT" />
							<field id="Arrange" type="String" label="安排合计" expression="t.Arrange" />
							<field id="Receipt" type="String" label="待发合计" expression="t.Receipt" />
							<field id="Send" type="String" label="发货合计" expression="t.Send" />
							<field id="Paid" type="String" label="付款合计" expression="t.Paid" />
							
							<field id="proNumber" type="String" label="项目编号" expression="t.proNumber" />
							<field id="proName" type="String" label="项目名称" expression="t.proName" />
							<field id="proType" type="String" label="项目类型" expression="t.proType" />
							<field id="proOptions" type="String" label="工程内容" expression="t.proOptions" />
							<field id="billUnit" type="String" label="开票单位" expression="t.billUnit" />
							<field id="saleMan" type="String" label="业务人员" expression="t.saleMan" />
							<field id="designMan" type="String" label="方案人员" expression="t.designMan" />
							<field id="province" type="String" label="省份" expression="t.province" />
							<field id="city" type="String" label="城市" expression="t.city" />
							<field id="area" type="String" label="区域" expression="t.area" />
							<field id="siteAmount" type="String" label="约有网点数" expression="t.siteAmount" />
							<field id="createUser" type="String" label="开单人" expression="t.createUser" />
							<field id="modifytime" type="DateTime" label="编辑时间" expression="t.modifytime" />
							<field id="version" type="int" label="版本" visible="false" expression="t.version" />
						</fields>
						<DataSource><![CDATA[
							from sa_OrderTicket t
						]]>
						</DataSource>
					</property>
				</property>
				<property name="DetailForm" label="本级订单明细" class="OrderTicketForm" builder="EditViewBuilder">
					<param name="menu">
						<attribute name="text" value="查看" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Order" />
							<param name="same">
								<attribute name="properties" value="number,clientName,stOrder0" />
								<attribute name="select1" value="self" />
							</param>
							<param name="parameter">
								<attribute name="id" value="billId" />
								<attribute name="version" value="billVersion" />
								<attribute name="class" value="BillDetail" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="method" value="prepareShow" />
						</param>
						<param name="listener">
							<attribute name="class" value="ForwardListener" />
							<attribute name="view-name" value="Show" />
							<attribute name="target" value="ShowQuery" />
						</param>
					</param>
					<param name="menu">
						<attribute name="text" value="打印" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Order" />
							<param name="same">
								<attribute name="properties" value="number,clientName,orderName" />
								<attribute name="select" value="all" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="setter" value="preparePrint" />
						</param>
					</param>
					<param name="menu">
						<attribute name="text" value="选择OrderDetail" />
						<attribute name="image" value="mily/img/color.gif" />
						<attribute name="show" value="false" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Order" />
						</param>
					</param>
					<param name="cfg">
						<attribute name="type" value="top" />
						<attribute name="position" value="row" />
					</param>
					<property name="selectedList" class="OrderDetail" builder="SqlListBuilder">
						<fields>
							<field id="id" type="Long" label="选择" expression="c.ID" />
							<field id="id0" type="Long" label="订单ID" visible="false" expression="c.ID" />
							<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
							<field id="billId" type="Long" label="开票ID" visible="false" expression="b.id" />
							<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
							<field id="number" type="String" label="订单号" expression="c.number" >
								<param name="format">
									<attribute name="properties" value="number,stOrder" />
									<attribute name="method" value="getColumnOrder" />
								</param>
							</field>
							<field id="commName" type="String" label="商品名称" expression="c.commName" />
							<field id="clientName" type="String" label="客户名称" expression="c.clientName" />
							<field id="subName" type="String" label="分公司名称" expression="c.subName" />
							<field id="amount" type="Double" label="数量" expression="c.amount" >
								<param name="footer">
									<attribute name="type" value="SUM" />
									<attribute name="expression" value="sum(c.amount)" />
								</param>
							</field>
							<field id="cprice" type="Double" label="订单价" expression="c.cprice" />
							<field id="supplyType" type="String" label="供货方式" expression="c.supplyType" />
							<field id="proNumber" type="String" label="项目编号" expression="c.proNumber" />
							<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
							<field id="arrangeName" type="String" label="排单名称" expression="c.arrangeName" />
							<field id="sendName" type="String" label="发料名称" expression="c.sendName" />
							<field id="outstore" type="String" label="出货仓" expression="c.outstore" />
							<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
							<field id="modifytime" type="Date" label="编辑时间" expression="c.modifytime" />
							<field id="uorder" type="String" label="订单人" expression="c.uorder" />
							<field id="orderType" type="String" label="订单类型" visible="false" expression="c.orderType" />
							<field id="stOrder0" type="String" label="订单状态" expression="case when c.stOrder=0 then '失效' else null end" />
							<field id="stOrder" type="int" label="订单流程Id" visible="false" expression="c.stOrder" />
							<field id="arrangeId" type="int" label="排单流程Id" visible="false" expression="c.arrangeId" />
							<field id="version" type="int" label="订单版本" visible="false" expression="c.version" />
							<field id="billVersion" type="int" label="开票版本" visible="false" expression="b.version" />
						</fields>
						<DataSource><![CDATA[
							from sa_OrderDetail c
							left join sa_BillDetail b on b.sellerId=c.sellerId and b.monthnum=c.monthnum and b.stBill>0 and b.amount=c.amount and b.typeName='销售出货'
						]]>
						</DataSource>
					</property>
				</property>
				<property name="SelfForm" label="受理链接订单" class="OrderTicketForm" builder="EditViewBuilder">
					<property name="selectedList" class="OrderDetail" builder="SqlListBuilder">
						<fields>
							<field id="id" type="Long" label="选择" expression="c.ID" />
							<field id="id0" type="Long" label="订单ID" visible="false" expression="c.ID" />
							<field id="SellerId" type="Long" label="链接来源商家ID" visible="false" expression="c.fromSellerId" />
							<field id="billId" type="Long" label="开票ID" visible="false" expression="b.id" />
							<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
							<field id="number" type="String" label="订单号" expression="c.number" >
								<param name="format">
									<attribute name="properties" value="number,stOrder" />
									<attribute name="method" value="getColumnOrder" />
								</param>
							</field>
							<field id="uaccept" type="String" label="接单商家" expression="c.uaccept" />
							<field id="commName" type="String" label="商品名称" expression="c.commName" />
							<field id="clientName" type="String" label="客户名称" expression="c.clientName" />
							<field id="subName" type="String" label="分公司名称" expression="c.subName" />
							<field id="amount" type="Double" label="数量" expression="c.amount" >
								<param name="footer">
									<attribute name="type" value="SUM" />
									<attribute name="expression" value="sum(c.amount)" />
								</param>
							</field>
							<field id="cprice" type="Double" label="订单价" expression="c.cprice" />
							<field id="supplyType" type="String" label="供货方式" expression="c.supplyType" />
							<field id="proNumber" type="String" label="项目编号" expression="c.proNumber" />
							<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
							<field id="arrangeName" type="String" label="排单名称" expression="c.arrangeName" />
							<field id="sendName" type="String" label="发料名称" expression="c.sendName" />
							<field id="outstore" type="String" label="出货仓" expression="c.outstore" />
							<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
							<field id="modifytime" type="Date" label="编辑时间" expression="c.modifytime" />
							<field id="uorder" type="String" label="订单人" expression="c.uorder" />
							<field id="orderType" type="String" label="订单类型" visible="false" expression="c.orderType" />
							<field id="stOrder0" type="int" label="订单状态" expression="case when c.stOrder then '失效' else null end" />
							<field id="stOrder" type="int" label="订单Id" visible="false" expression="c.stOrder" />
							<field id="version" type="int" label="订单版本" visible="false" expression="c.version" />
							<field id="billVersion" type="int" label="开票版本" visible="false" expression="b.version" />
						</fields>
						<DataSource><![CDATA[
							from sa_OrderDetail c
							left join sa_BillDetail b on b.sellerId=c.sellerId and b.monthnum=c.monthnum and b.stBill>0 and b.amount=c.amount and b.typeName='销售出货'
						]]>
						</DataSource>
					</property>
				</property>
			</property>
		</view>
		<view name="AuditList" label="审核商家订单" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="before" value="beforeWaiting" />
			</param>
			<param name="menu">
				<attribute name="text" value="审核" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Order" />
					<attribute name="view-name" value="selectedList" />
					<param name="same">
						<attribute name="properties" value="number,clientName" />
						<attribute name="select" value="all" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareAudit" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Audit" />
				</param>
			</param>
			<property name="selectedList" class="OrderDetail" label0="待审核生效的上传商家订单" builder="SqlListBuilder">
				<param name="cfg">
					<attribute name="parameter" value="getParam4Order"/>
				</param>
				<param name="remind">
					<attribute name="id" value="id" />
					<attribute name="value" value=">0" />
				</param>
				<param name="select">
					<attribute name="id" value="id" />
					<attribute name="value" value=">0" />
				</param>
				<fields>
					<field id="id" type="Long" label="选择" expression="c.ID" />
					<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
					<field id="number" type="String" label="订单号" expression="c.number" />
					<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
					<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
					<field id="clientName" type="String" label="客户名称" expression="c.clientName" />
					<field id="subName" type="String" label="分公司名称" expression="c.subName" />
					<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
					<field id="commName" type="String" label="商品名称" expression="c.commName" />
					<field id="supplyType" type="String" label="供货方式" expression="c.supplyType" />
					<field id="amount" type="Double" label="数量" expression="c.amount" />
					<field id="cprice" type="Double" label="订单价" expression="c.cprice" />
					<field id="uorder" type="String" label="订单人" expression="c.uorder" />
					<field id="stOrder" type="int" label="订单状态ID" visible="false" expression="c.stOrder" />
					<field id="arrangeId" type="int" label="排单状态ID" visible="false" expression="c.arrangeId" />
					<field id="sendId" type="int" label="发料状态ID" visible="false" expression="c.sendId" />
					<field id="version" type="int" label="版本" visible="false" expression="c.version" />
				</fields>
				<DataSource><![CDATA[
					from sa_OrderDetail c
				]]>
				</DataSource>
				<Where><![CDATA[
					c.stOrder=20 and {$SubCompany}
				]]></Where>
			</property>
		</view>
		<view name="RechangeList" label="返订单改单" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="before" value="beforeWaiting" />
			</param>
			<param name="menu">
				<attribute name="text" value="订单改单处理" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Order" />
					<attribute name="view-name" value="selectedList" />
					<param name="same">
						<attribute name="properties" value="number,clientName" />
						<attribute name="select" value="self" />
					</param>
					<param name="validate">
						<attribute name="properties" value="commName,stOrder" />
						<attribute name="method" value="ticketForm.canOrderChange" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareChange" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Rechange" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="采购改单处理" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
					<param name="same">
						<attribute name="properties" value="number,clientName,notes,purName,stOrder" />
						<attribute name="select" value="self" />
					</param>
					<param name="validate">
						<attribute name="properties" value="commName,stOrder" />
						<attribute name="method" value="ticketForm.canPurchaseChange" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="preparePurChange" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="PurChange" />
				</param>
			</param>
			<property name="selectedList" class="OrderDetail" label0="改单申请审核1" builder="SqlListBuilder">
				<param name="cfg">
					<attribute name="parameter" value="getParam4Order" />
				</param>
				<param name="remind">
					<attribute name="id" value="id" />
					<attribute name="value" value=">0" />
				</param>
				<param name="select">
					<attribute name="id" value="id" />
					<attribute name="value" value=">0" />
				</param>
				<fields>
					<field id="id" type="Long" label="选择" expression="c.ID" />
					<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
					<field id="number" type="String" label="订单号" expression="c.number" />
					<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
					<field id="commName" type="String" label="商品名称" expression="c.commName" />
					<field id="uneditable" type="String" label="改单类型" expression="case
						when (c.stOrder=40) then '订单改单'
						when (c.stOrder=43) then '采购改单'
						else null end" />
					<field id="changeRemark" type="String" label="改单申请原因" expression="c.changeRemark" />
					<field id="uchange" type="String" label="改单人" expression="c.uchange" />
					<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
					<field id="uorder" type="String" label="订单人" expression="c.uorder" />
					<field id="clientName" type="String" label="客户名称" expression="c.clientName" />
					<field id="subName" type="String" label="分公司名称" expression="c.subName" />
					<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
					<field id="purName" type="String" label="采购名称" expression="c.purName" />
					<field id="supplyType" type="String" label="供货方式" expression="c.supplyType" />
					<field id="notes" type="String" label="采购改单内容" visible0="false" expression="c.notes" />
					<field id="amount" type="Double" label="数量" expression="c.amount" />
					<field id="cprice" type="Double" label="订单价" expression="c.cprice" />
					<field id="stOrder" type="int" label="订单状态ID" visible="false" expression="c.stOrder" />
					<field id="version" type="int" label="订单版本" visible="false" expression="c.version" />
				</fields>
				<DataSource><![CDATA[
					from sa_OrderDetail c
				]]>
				</DataSource>
				<Where><![CDATA[
					(c.stOrder=40 or c.stOrder=43) and {$SubCompany}
				]]></Where>
			</property>
		</view>
		<view name="DoadjustList" label="红冲申请" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="before" value="beforeWaiting" />
			</param>
			<param name="menu">
				<attribute name="text" value="已排单红冲" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Order" />
					<attribute name="view-name" value="selectedList" />
					<param name="validate">
						<attribute name="properties" value="commName,uneditable,stOrder,arrangeId" />
						<attribute name="method" value="ticketForm.canDoadjust" />
					</param>
					<param name="same">
						<attribute name="properties" value="number,clientName,stOrder" />
						<attribute name="select" value="self" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareDoadjust" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Doadjust" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="未排单编辑" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Order" />
					<attribute name="view-name" value="selectedList" />
					<param name="validate">
						<attribute name="properties" value="commName,uneditable,stOrder,arrangeId" />
						<attribute name="method" value="ticketForm.canReedit" />
					</param>
					<param name="same">
						<attribute name="properties" value="number,clientName,stOrder" />
						<attribute name="select" value="self" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareDoadjust" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Reedit" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="追加订单商品" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Order" />
					<attribute name="view-name" value="selectedList" />
					<param name="validate">
						<attribute name="properties" value="commName,uneditable,stOrder,arrangeId" />
						<attribute name="method" value="ticketForm.canDoadjust" />
					</param>
					<param name="same">
						<attribute name="properties" value="number,clientName" />
						<attribute name="select" value="self" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareDoadjustAdd" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Doadjust" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="红冲驳回确认" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Order" />
					<attribute name="view-name" value="selectedList" />
					<param name="validate">
						<attribute name="properties" value="commName,stOrder" />
						<attribute name="method" value="ticketForm.canDoadjustConfirm" />
					</param>
					<param name="same">
						<attribute name="properties" value="number,clientName" />
						<attribute name="select" value="self" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareDoadjust" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Doadjust" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="开红冲草稿Untrans" />
				<attribute name="image" value="mily/img/color.gif" />
				<attribute name="show" value="false" />
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="property" value="selectFormer4Order.selectedList" />
						<attribute name="message" value="客户商家改商品开红冲草稿单" />
						<param name="state">
							<attribute name="id" value="51" />
							<attribute name="name" value="客户商家改商品开红冲草稿" />
							<attribute name="method" value="setOrderState" />
						</param>
						<param name="user">
							<attribute name="method" value="setChangeUser" />
						</param>
					</param>
				</param>
			</param>
			<property name="orderDetail.amount" label="拆分出订单数量" builder="TextFieldBuilder" >
				<param name="validate">
					<attribute name="validate"><![CDATA[eval(this.value)>0]]></attribute>
					<attribute name="message" value="拆分数量要大于0" />
				</param>
				<param name="button">
					<attribute name="text" value="拆分订单" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
						<attribute name="former" value="selectFormer4Order" />
						<attribute name="view-name" value="selectedList" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="validateSplitAmount" />
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<attribute name="message" value="确认在排单红冲处理拆分出此数量的订单连同采购单" />
						<param name="action">
							<attribute name="action" value="OrderTicket_Save" />
							<attribute name="setter" value="setSplitNew4Service" />
							<attribute name="message" value="拆分出数量记新订单，用新月流水号" />
						</param>
						<param name="action">
							<attribute name="action" value="OrderTicket_Save" />
							<attribute name="setter" value="setSplitRemain4Service" />
							<attribute name="message" value="拆分剩余数量记原订单" />
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="RefreshListener" />
						<attribute name="before" value="setOrderDetailClear" />
					</param>
				</param>
			</property>
			<property name="selectedList" class="OrderDetail" label="未发货可开单红冲" builder="SqlListBuilder">
				<param name="cfg">
					<attribute name="parameter" value="getParam4Order"/>
				</param>
				<param name="menu">
					<attribute name="text" value="选择订单" />
					<attribute name="image" value="mily/img/color.gif" />
					<attribute name="show" value="false" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
						<attribute name="former" value="selectFormer4Order" />
					</param>
				</param>
				<param name="remind">
					<attribute name="id" value="stOrder" />
					<attribute name="value" value="=52 or =51" />
				</param>
				<param name="select">
					<attribute name="id" value="stOrder" />
					<attribute name="value" value="=52" />
				</param>
				<fields>
					<field id="id" type="Long" label="选择" expression="c.ID" />
					<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
					<field id="number" type="String" label="订单号" expression="c.number" />
					<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
					<field id="uneditable" type="String" label="可否处理"><![CDATA[case
						when (c.stOrder>=40 && c.stOrder<50) then '不可，返单处理中'
						when (c.stOrder=50) then '不可，待红冲处理中'
						when (c.stOrder=52) then '待订单红冲驳回'
						when (c.stOrder=51) then '客户商家订单红冲'
						else null end]]>
					</field>
					<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
					<field id="clientName" type="String" label="客户名称" expression="c.clientName" />
					<field id="subName" type="String" label="分公司名称" expression="c.subName" />
					<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
					<field id="commName" type="String" label="商品名称" expression="c.commName" />
					<field id="supplyType" type="String" label="供货方式" expression="c.supplyType" />
					<field id="amount" type="Double" label="数量" expression="c.amount" >
						<param name="footer">
							<attribute name="type" value="SUM" />
							<attribute name="expression" value="sum(c.amount)" />
						</param>
					</field>
					<field id="cprice" type="Double" label="订单价" expression="c.cprice" />
					<field id="uorder" type="String" label="订单人" expression="c.uorder" />
					<field id="stOrder" type="int" label="订单状态ID" visible="false" expression="c.stOrder" />
					<field id="arrangeId" type="int" label="排单状态ID" visible="false" expression="c.arrangeId" />
					<field id="sendId" type="int" label="发料状态ID" visible="false" expression="c.sendId" />
					<field id="version" type="int" label="版本" visible="false" expression="c.version" />
					<field id="stPurchase" type="int" label="采购状态ID" visible="false" expression="c.stPurchase" />
				</fields>
				<DataSource><![CDATA[
					from sa_OrderDetail c
				]]>
				</DataSource>
				<Where><![CDATA[
					c.stOrder>=30 and c.sendId<30 and {$SubCompany}
				]]></Where>
			</property>
		</view>
		<view name="Reedit" builder="EditViewBuilder">
			<param name="note">
				<attribute name="type" value="has-note" />
				<attribute name="former" value="noteFormer4Order" />
			</param>
			<param name="menu">
				<attribute name="text" value="提交" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Order.revalidate"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ValidateListener" />
					<attribute name="setter" value="validateReedit" />
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<param name="action">
						<attribute name="action" value="OrderTicket_T" />
						<attribute name="setter" value="setTicket4Service" />
						<attribute name="message" value="重编辑保存订单单头" />
					</param>
					<param name="action">
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="setter" value="setReeditSave4Service" />
						<attribute name="message" value="订单未排单重编辑提交" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="审核商家订单通过" />
							<attribute name="method" value="setOrderState" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="OrderTicket_Delete" />
						<attribute name="setter" value="setReeditDelete4Service" />
						<attribute name="message" value="订单未排单重编辑为0删除" />
					</param>
					<param name="action">
						<attribute name="action" value="OrderTicket_Effect" />
						<attribute name="setter" value="setEffect4Service" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Count" />
						<attribute name="property" value="SelectFormer4Order.selectedList" />
						<attribute name="message" value="订单全单统计" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener"/>
					<attribute name="view-name" value="DoadjustList"/>
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="返回" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener"/>
					<attribute name="getter" value="getForwardFromBuilder"/>
				</param>
			</param>
			<property name="domain" class="OrderDetail"/>
			<property name="domain.voParamMap.ClientDoadjust" label="客户商家红冲" builder="TextBuilder">
				<param name="show">
					<attribute name="expression" value="stOrder=51" />
					<attribute name="property" value="selectFormer4Order.First" />
				</param>
				<param name="button">
					<attribute name="text" value="已客户商家红冲申请处理" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
						<attribute name="former" value="selectEdit4Order" />
					</param>
					<param name="listener">
						<attribute name="class" value="ValidateListener" />
						<attribute name="setter" value="validateClientLinkReedit" />
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="view-name" value="Reedit" />
					</param>
				</param>
			</property>
			<property name="detailList" class="OrderDetail" builder="EditListBuilder">
				<param name="menu">
					<attribute name="text" value="移除明细" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDeleteListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="expression" value="detailList.size=0" />
						<attribute name="target" value="Reedit" />
					</param>
				</param>
			</property>
		</view>
		<view name="Doadjust" builder="ChangeViewBuilder">
			<param name="note">
				<attribute name="former" value="noteFormer4Order" />
			</param>
			<param name="menu">
				<attribute name="text" value="提交更改" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="setter" value="setChangeNotes" />
				</param>
				<param name="listener">
					<attribute name="class" value="ValidateListener" />
					<attribute name="setter" value="validateDoadjust" />
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Order.revalidate"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<param name="action">
						<attribute name="action" value="OrderTicket_T" />
						<attribute name="setter" value="setTicketDoadjust4Service" />
						<attribute name="message" value="已排单订单开红冲保存改后单头" />
					</param>
					<param name="action">
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="setter" value="setDoadjust4Service" />
						<attribute name="message" value="已排单订单开红冲" />
						<param name="state">
							<attribute name="id" value="50" />
							<attribute name="name" value="订单红冲" />
							<attribute name="method" value="setOrderState" />
						</param>
						<param name="user">
							<attribute name="method" value="setChangeUser" />
						</param>
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="提交新增" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ValidateListener" />
					<attribute name="method" value="validateDoadjustAdd" />
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="setter" value="setAdd4Service" />
						<attribute name="message" value="红冲额外新增订单明细" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="订单生效" />
							<attribute name="method" value="setOrderState" />
						</param>
						<param name="user">
							<attribute name="method" value="setOrderUser" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="OrderTicket_Effect" />
						<attribute name="setter" value="setAdd4Service" />
						<attribute name="message" value="重计算够用库存量" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Count" />
						<attribute name="property" value="SelectFormer4Order.selectedList" />
						<attribute name="message" value="订单全单统计" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ChangeAssociateListener"/>
					<attribute name="method" value="setCreateListClear"/>
					<attribute name="properties" value="createList"/>
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="删除红冲申请" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="TerminateListener" />
					<attribute name="expression" value="domain.stOrder!=52" />
					<attribute name="message" value="驳回的红冲才能删除！" />
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="action" value="OrderTicket_AdjustDelete" />
					<attribute name="setter" value="setDoadjust4Service" />
					<param name="state">
						<attribute name="id" value="30" />
						<attribute name="name" value="删除红冲申请" />
						<attribute name="method" value="setOrderState" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="返回列表" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="domain" class="OrderDetail"/>
			<property name="domain.voParamMap.ClientDoadjust" label="客户商家红冲" builder="TextBuilder">
				<param name="show">
					<attribute name="expression" value="stOrder=51" />
					<attribute name="property" value="selectFormer4Order.First" />
				</param>
				<param name="button">
					<attribute name="text" value="已客户商家红冲申请处理" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
						<attribute name="former" value="selectEdit4Order" />
					</param>
					<param name="listener">
						<attribute name="class" value="ValidateListener" />
						<attribute name="setter" value="validateClientLinkDoadjust" />
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="view-name" value="Doadjust" />
					</param>
				</param>
			</property>
			<property name="domain.changeRemark" label="红冲申请原因" builder="TextAreaBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
			</property>
			<property name="detailList" class="OrderDetail" builder="ChangeListBuilder">
				<param name="menu">
					<attribute name="text" value="取消下单" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="setZeroAmount" />
					</param>
					<param name="listener">
						<attribute name="class" value="RefreshListener" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="移除明细" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDeleteListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="expression" value="createList.size+detailList.size=0" />
						<attribute name="target" value="Doadjust" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="复制新增明细" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener"/>
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="addDetail4CreateCopy" />
					</param>
					<param name="listener">
						<attribute name="class" value="RefreshListener" />
						<attribute name="view-name" value="createList" />
					</param>
				</param>
				<property name="monthnum" label="月流水号" builder="TextBuilder"/>
				<property name="commodity" class="Commodity"/>
				<property name="amount" label="数量" builder="TextFieldBuilder" >
					<param name="cfg">
						<attribute name="editable" value="false" />
					</param>
					<param name="validate">
						<attribute name="setter"><![CDATA[[{$OrderTicket.cmoney}]]]></attribute>
					</param>
				</property>
				<property name="OrderTicket.cprice" label="单价" builder="TextFieldBuilder" >
					<param name="validate">
						<attribute name="setter"><![CDATA[[{$OrderTicket.cmoney}]]]></attribute>
					</param>
				</property>
	        	<property name="OrderTicket.cmoney" label="商品合价" builder="TextFieldBuilder">
					<param name="validate">
						<attribute name="getter"><![CDATA[
var tprice={$OrderTicket.cprice}.svalue, tamount={$amount}.svalue;
if (tprice.length>0 && tamount.length>0) {
	this.value=eval(tprice) * eval(tamount);
} else {
	this.value=null;
}
this.onblur();
						]]></attribute>
					</param>
	        	</property>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
				<property name="voParamMap.PurchaseT.Ticket" label="采购名称" builder="TextBuilder" />
				<property name="voParamMap.SupplierT.Trunk" label="供应商名称" builder="TextBuilder" />
				<property name="voParamMap.ReceiptT.Ticket" label="收货名称" builder="TextBuilder" />
			</property>
			<property name="createList" class="OrderDetail" builder="EditListBuilder">
				<param name="menu">
					<attribute name="text" value="添加明细" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="addDetail4Create" />
					</param>
					<param name="listener">
						<attribute name="class" value="RefreshListener" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="移除明细" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDeleteListener"/>
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="expression" value="createList.size+detailList.size=0" />
						<attribute name="target" value="Doadjust" />
					</param>
				</param>
				<property name="monthnum" label="月流水号" builder="TextBuilder"/>
				<property name="commodity" class="Commodity"/>
				<property name="amount" label="数量" builder="TextFieldBuilder" >
					<param name="validate">
						<attribute name="setter"><![CDATA[[{$OrderTicket.cmoney}]]]></attribute>
					</param>
				</property>
				<property name="OrderTicket.cprice" label="单价" builder="TextFieldBuilder" >
					<param name="validate">
						<attribute name="setter"><![CDATA[[{$OrderTicket.cmoney}]]]></attribute>
					</param>
				</property>
	        	<property name="OrderTicket.cmoney" label="商品合价" builder="TextFieldBuilder">
					<param name="validate">
						<attribute name="getter"><![CDATA[
var tprice={$OrderTicket.cprice}.svalue, tamount={$amount}.svalue;
if (tprice.length>0 && tamount.length>0) {
	this.value=eval(tprice) * eval(tamount);
} else {
	this.value=null;
}
this.onblur();
						]]></attribute>
					</param>
	        	</property>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
			</property>
		</view>
		<view name="Audit" builder="EditViewBuilder">
			<param name="note">
				<attribute name="former" value="noteFormer4Order" />
			</param>
			<param name="menu">
				<attribute name="text" value="审核通过" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="selectFormer4Order.revalidate" />
				</param>
				<param name="listener">
					<attribute name="class" value="ValidateListener" />
					<attribute name="method" value="validateAuditYes" />
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="message" value="成为生效客户订单，进入排单" />
					<param name="action">
						<attribute name="action" value="OrderTicket_T" />
						<attribute name="setter" value="setTicket4Service" />
						<attribute name="message" value="保存订单单头" />
					</param>
					<param name="action">
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="setter" value="setEffect4Service" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="审核商家订单通过" />
							<attribute name="method" value="setOrderState" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="OrderTicket_Effect" />
						<attribute name="setter" value="setEffect4Service" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Count" />
						<attribute name="property" value="SelectFormer4Order.selectedList" />
						<attribute name="message" value="订单全单统计" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="不通过" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="setter" value="setOrderChangeNotes" />
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="selectFormer4Order.revalidate" />
				</param>
				<param name="listener">
					<attribute name="class" value="ValidateListener" />
					<attribute name="method" value="validateAuditNo" />
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="message" value="删除商家客户订单" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Delete" />
						<attribute name="setter" value="setEffect4Service" />
						<attribute name="message" value="删除上级商家客户订单" />
					</param>
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Save" />
						<attribute name="message" value="生成客户商家采购改单申请" />
						<attribute name="setter" value="setPurchaseLink4Service" />
						<attribute name="expression" value="domain.client.uaccept!=null or domain.subCompany.uaccept!=null" />
						<param name="state">
							<attribute name="id" value="20" />
							<attribute name="name" value="链接商家不通过采购单" />
							<attribute name="method" value="setPurchaseState" />
						</param>
						<param name="user">
							<attribute name="method" value="setPurChangeUser" />
						</param>
						<param name="before">
							<attribute name="method" value="PurchaseLink.actionBefore" />
						</param>
						<param name="after">
							<attribute name="method" value="ActionService4LinkListener.actionAfter" />
						</param>
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="返回列表" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="domain" class="OrderDetail" builder="AuditViewBuilder">
				<param name="note">
					<attribute name="type" value="hidden" />
				</param>
			</property>
			<property name="domain.changeRemark" label="改单备注" builder="TextAreaBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
			</property>
			<property name="detailList" class="OrderDetail" builder="ChangeListBuilder">
				<param name="menu">
					<attribute name="text" value="移除明细" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDeleteListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="expression" value="detailList.size=0" />
						<attribute name="target" value="Audit" />
					</param>
				</param>
				<property name="monthnum" label="月流水号" builder="TextBuilder" />
				<property name="commodity" class="Commodity" />
				<property name="amount" label="数量" builder="TextBuilder" />
				<property name="OrderTicket.Detail" class="OrderTicket" />
				<property name="OrderTicket.cprice" label="订单价" builder="TextBuilder" />
				<property name="remark" label="明细备注" builder="TextBuilder"/>
			</property>
		</view>
		<view name="Import" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="menu" value="加载列配置" />
			</param>
			<param name="menu">
				<attribute name="text" value="导入为明细" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ValidateListener" />
					<attribute name="method" value="validateImport"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="setImportListAdd"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="setter" value="setImportBackBuilder"/>
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="加载列配置" />
				<attribute name="image" value="mily/img/color.gif" />
				<attribute name="show" value="false" />
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="setter" value="setImportLabelLoad"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="setter" value="BaseImportForm.getSellerIndexes"/>
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="返回订单" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="setter" value="setImportBackBuilder"/>
				</param>
			</param>
			<property name="domain.voParamMap.Remark" label="单元格内容" builder="TextAreaBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
			</property>
			<property name="domain" label="标题行配置" class="OrderDetail" builder="EditListBuilder">
				<param name="menu">
					<attribute name="text" value="默认依次顺序" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="BaseImportForm.setImportIndexDefault" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="清空顺序" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="BaseImportForm.setImportIndexClear" />
					</param>
				</param>
				<param name="cfg">
					<attribute name="property" value="Choose-Edit" />
				</param>
				<property name="voParamMap.note" label="标题名" builder="TextBuilder"/>
				<property name="commodity" class="Commodity"/>
				<property name="amount" label="数量" builder="TextFieldBuilder"/>
				<property name="OrderTicket.cprice" label="订单价" builder="TextFieldBuilder"/>
				<property name="OrderTicket.Detail" class="OrderTicket"/>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
			</property>
			<property name="importList" label="格式化整理" class="OrderDetail" builder="EditListBuilder">
				<param name="menu">
					<attribute name="text" value="删除行" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDeleteListener" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="导入格式化" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="ValidateListener" />
						<attribute name="setter" value="validateToImport"/>
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="setImportFormated"/>
					</param>
					<param name="listener">
						<attribute name="class" value="RefreshListener" />
					</param>
				</param>
				<param name="cfg">
					<attribute name="property" value="Choose-Edit" />
				</param>
				<property name="commodity" class="Commodity"/>
				<property name="amount" label="数量" builder="TextFieldBuilder"/>
				<property name="OrderTicket.cprice" label="订单价" builder="TextFieldBuilder"/>
				<property name="OrderTicket.Detail" class="OrderTicket"/>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
				<property name="voParamMap.error" label="导入行错误" builder="TextFieldBuilder"/>
			</property>
		</view>
		<view name="Show" builder="AuditViewBuilder">
			<param name="note">
				<attribute name="type" value="hidden" />
				<attribute name="former" value="noteFormer4Order" />
			</param>
			<param name="menu">
				<attribute name="text" value="返回列表" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="domain" class="OrderDetail">
				<property name="client" class="Client" />
				<property name="subCompany" class="SubCompany" />
				<property name="OrderTicket.Ticket" class="OrderTicket" />
				<property name="ArrangeTicket.Ticket" class="ArrangeTicket" />
				<property name="SendTicket.Ticket" class="SendTicket" />
			</property>
			<property name="domain.uorder" label="订单人" builder="TextBuilder"/>
			<property name="detailList" label="订单明细" class="OrderDetail" builder="EditSqlBuilder">
				<property name="monthnum" label="月流水号" builder="TextBuilder" />
				<property name="commodity" class="Commodity" builder="AuditListBuilder"/>
				<property name="amount" label="数量" builder="TextBuilder" />
				<property name="OrderTicket.cprice" label="订单价" builder="TextBuilder" />
				<property name="OrderTicket.Detail" class="OrderTicket" />
				<property name="remark" label="明细备注" builder="TextBuilder"/>
				<property name="notes" label="改单内容" builder="TextBuilder" />
				<property name="changeRemark" label="改单备注" builder="TextBuilder" />
			</property>
			<property name="detailList" label="订单流程状态" class="OrderDetail" builder="EditListBuilder">
				<property name="monthnum" label="月流水号" builder="TextBuilder" />
				<property name="SOrder" label="订单名称" builder="TextBuilder"/>
				<property name="SArrange" label="排单名称" builder="TextBuilder"/>
				<property name="SSend" label="发货名称" builder="TextBuilder"/>
				<property name="SOutstore" label="出库名称" builder="TextBuilder"/>
				<property name="voParamMap.BillDetail.SBill" label="开票回款名称" builder="TextBuilder"/>
				<property name="SPurchase" label="采购名称" builder="TextBuilder"/>
				<property name="SReceipt" label="收货名称" builder="TextBuilder"/>
			</property>
			<property name="detailList" label="明细日志" class="OrderDetail" builder="EditListBuilder">
				<property name="monthnum" label="物料Bom表" builder="HyperlinkBuilder" >
					<param name="cfg">
						<attribute name="setter" value="setBDetailsLink" />
					</param>
				</property>
				<property name="stateNotes" label="流程日志" builder="TextBuilder" />
			</property>
		</view>
		<view name="Print" builder="AuditViewBuilder">
			<param name="cfg">
				<attribute name="freezable" value="false" />
				<attribute name="columns" value="4" />
			</param>
			<property name="domain" class="OrderDetail">
				<property name="OrderTicket.Ticket" class="OrderTicket" />
				<property name="client" class="Client" />
				<property name="subCompany" class="SubCompany" />
				<property name="uorder" label="订单人" builder="TextBuilder"/>
			</property>
			<property name="detailList" label="订单明细" class="OrderDetail" builder="AuditListBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
				<property name="monthnum" label="月流水号" builder="TextBuilder" />
				<property name="commodity" class="Commodity" builder="AuditListBuilder"/>
				<property name="amount" label="数量" builder="TextBuilder" />
				<property name="OrderTicket.cprice" label="订单价" builder="TextBuilder" />
				<property name="OrderTicket.cmoney" label="订单合价" builder="TextBuilder" >
					<param name="footer">
						<attribute name="type" value="SUM" />
						<attribute name="expression" value="sum(OrderTicket.cmoney)" />
					</param>
				</property>
				<property name="OrderTicket.Detail" class="OrderTicket"/>
				<property name="remark" label="明细备注" builder="TextBuilder"/>
			</property>
		</view>
		<view name="Rechange" builder="EditViewBuilder">
			<param name="note">
				<attribute name="type" value="has-note" />
				<attribute name="former" value="noteFormer4Order" />
			</param>
			<param name="menu">
				<attribute name="text" value="改单同意" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ValidateListener" />
					<attribute name="method" value="validateChangeYes" />
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Order.revalidate"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="message" value="同意改单申请的更改内容" />
					<param name="action">
						<attribute name="action" value="OrderTicket_ChangeEffect" />
						<attribute name="setter" value="setChange4Service" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="改单申请已同意" />
							<attribute name="method" value="setChangeState" />
							<attribute name="select" value="amount>0" />
						</param>
						<param name="state">
							<attribute name="id" value="0" />
							<attribute name="name" value="改单申请已同意数量为0" />
							<attribute name="method" value="setChangeState" />
							<attribute name="select" value="amount=0" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="OrderTicket_Effect" />
						<attribute name="setter" value="setEffect4Service" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Count" />
						<attribute name="property" value="SelectFormer4Order.selectedList" />
						<attribute name="message" value="订单全单统计" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="不同意" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ValidateListener" />
					<attribute name="method" value="validateChangeNo" />
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="action" value="OrderTicket_Save" />
					<attribute name="setter" value="setChangeNo4Service" />
					<attribute name="message" value="不同意改单内容，要求改单调整" />
					<param name="state">
						<attribute name="id" value="42" />
						<attribute name="name" value="改单申请不同意" />
						<attribute name="method" value="setChangeState" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="返回列表" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="domain" class="OrderDetail" builder="ChangeViewBuilder">
				<property name="client" class="Client"/>
				<property name="subCompany" class="SubCompany"/>
				<property name="OrderTicket.Ticket" class="OrderTicket"/>
				<property name="uorder" label="订单人" builder="TextBuilder"/>
				<property name="uchange" label="改单人" builder="TextBuilder"/>
			</property>
			<property name="domain.changeRemark" label="改单备注" builder="TextAreaBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
			</property>
			<property name="detailList" class="OrderDetail" builder="ChangeListBuilder">
				<param name="menu">
					<attribute name="text" value="移除明细" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDeleteListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="expression" value="detailList.size=0" />
						<attribute name="target" value="Rechange" />
					</param>
				</param>
			</property>
		</view>
		<view name="PurChange" builder="ChangeViewBuilder">
			<param name="note">
				<attribute name="former" value="noteFormer4Purchase" />
				<attribute name="type" value="has-note" />
			</param>
			<param name="menu">
				<attribute name="text" value="提交同意项" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="setter" value="setPurchaseChangeNotes"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ValidateListener"/>
					<attribute name="method" value="validatePurchaseChangeYes"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Purchase.revalidate"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="setter" value="setPurChange4Service" />
						<attribute name="message" value="在订单处理采购改单申请" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="收货改单订单全部同意" />
							<attribute name="expression" value="OrderAgreeAll=true" />
							<attribute name="method" value="setOrderState" />
						</param>
						<param name="state">
							<attribute name="id" value="45" />
							<attribute name="name" value="收货改单订单部分同意" />
							<attribute name="expression" value="OrderAgreeAll=false" />
							<attribute name="method" value="setOrderState" />
						</param>
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Count" />
						<attribute name="property" value="SelectFormer4Purchase.selectedList" />
						<attribute name="message" value="订单全单统计" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="不同意" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="setter" value="setPurchaseChangeNotes"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ValidateListener"/>
					<attribute name="method" value="validatePurchaseChangeNo"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Purchase.revalidate"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="setter" value="setPurChange4Service" />
						<attribute name="message" value="在订单不同意采购改单申请" />
						<param name="state">
							<attribute name="id" value="45" />
							<attribute name="name" value="收货改单订单不同意" />
							<attribute name="method" value="setOrderState" />
						</param>
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="返回" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="purchaseFirst" class="OrderDetail">
				<param name="note">
					<attribute name="type" value="only-note" />
				</param>
				<property name="voParamMap.OrderAgree" label="订单同意改单项" builder="CheckBoxGroupBuilder">
					<param name="cfg">
						<attribute name="position" value="row" />
					</param>
					<param name="options">
						<attribute name="collection" value="getOrderAgreeOptions"/>
						<attribute name="value-property" value="key"/>
						<attribute name="text-property" value="value"/>
					</param>
				</property>
			</property>
			<property name="purchaseFirst.changeRemark" label="改单申请原因" builder="TextAreaBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
			</property>
			<property name="purchaseFirst" class="OrderDetail">
				<property name="ReceiptTicket.Ticket" class="ReceiptTicket"/>
				<property name="PurchaseTicket.Ticket" class="PurchaseTicket"/>
				<property name="supplier" class="Supplier"/>
				<property name="upurchase" label="采购人" builder="TextBuilder"/>
				<property name="uchange" label="收货改单人" builder="TextBuilder"/>
			</property>
			<property name="purchaseList" class="OrderDetail" builder="ChangeListBuilder">
				<property name="OrderTicket.number" label="订单号" builder="TextBuilder"/>
				<property name="voParamMap.OrderT.Ticket" label="订单名称" builder="TextBuilder"/>
				<property name="voParamMap.ClientT.Trunk" label="客户" builder="TextBuilder"/>
				<property name="voParamMap.SubCompanyT.Trunk" label="分公司" builder="TextBuilder"/>
				<property name="commodity" class="Commodity"/>
				<property name="price" label="采购价" builder="TextFieldBuilder">
					<param name="validate">
						<attribute name="validate"><![CDATA[eval(this.value)>0]]></attribute>
						<attribute name="message" value="单价要大于0" />
					</param>
				</property>
				<property name="amount" label="采购数量" builder="TextFieldBuilder"/>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
			</property>
		</view>
		<view name="ClientQuery" builder="EditViewBuilder">
			<param name="menu">
				<attribute name="text" value="确定" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="setter" value="setClientSelect" />
					<attribute name="view-name" value="selectedList"/>
				</param>
				<param name="listener">
					<attribute name="class" value="SimpleDialogCloseListener" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="关闭" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SimpleDialogCloseListener" />
				</param>
			</param>
			<property name="clientForm" class="ClientForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="ClientQuery"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
		</view>
		<view name="CommodityQuery" builder="EditViewBuilder">
			<param name="menu">
				<attribute name="text" value="确定" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="setter" value="setCommoditySelect" />
					<attribute name="view-name" value="selectedList" />
				</param>
				<param name="listener">
					<attribute name="class" value="SimpleDialogCloseListener" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="关闭" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SimpleDialogCloseListener" />
				</param>
			</param>
			<property name="commodityForm" class="CommodityForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="CommodityQuery.selectedList"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
		</view>
		<view name="ProjectQuery" builder="EditViewBuilder">
			<param name="menu">
				<attribute name="text" value="确定" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="setter" value="setProjectSelect" />
					<attribute name="view-name" value="selectedList" />
				</param>
				<param name="listener">
					<attribute name="class" value="SimpleDialogCloseListener" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="关闭" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SimpleDialogCloseListener" />
				</param>
			</param>
			<property name="selectedList" class="OrderTicket" builder="SqlListBuilder">
				<fields>
					<field id="id" type="Long" label="选择" expression="t.id" />
					<field id="SellerId" type="Long" label="商家ID" visible="false" expression="t.sellerId" />
					<field id="proNumber" type="String" label="项目编号" expression="t.proNumber" />
					<field id="proName" type="String" label="项目名称" expression="t.proName" />
					<field id="proType" type="String" label="项目类型" expression="t.proType" />
					<field id="proOptions" type="String" label="工程内容" expression="t.proOptions" />
					<field id="billUnit" type="String" label="开票单位" expression="t.billUnit" />
					<field id="saleMan" type="String" label="业务人员" expression="t.saleMan" />
					<field id="designMan" type="String" label="方案人员" expression="t.designMan" />
					<field id="province" type="String" label="省份" expression="t.province" />
					<field id="city" type="String" label="城市" expression="t.city" />
					<field id="area" type="String" label="区域" expression="t.area" />
					<field id="siteAmount" type="String" label="约有网点数" expression="t.siteAmount" />
					<field id="version" type="int" label="版本" visible="false" expression="t.version" />
				</fields>
				<DataSource><![CDATA[
					from sa_OrderTicket t
				]]>
				</DataSource>
				<Where><![CDATA[
					t.proNumber is not null
				]]>
				</Where>
			</property>
		</view>
		<view name="StorehouseQuery" label0="选择出库仓、入库仓" builder="EditViewBuilder">
			<param name="menu">
				<attribute name="text" value="关闭" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SimpleDialogCloseListener" />
				</param>
			</param>
			<property name="SelfForm" label0="分公司" class="OrderTicketForm" builder="EditViewBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
				<param name="menu">
					<attribute name="text" value="确定分公司" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
						<attribute name="former" value="selectFormer4SubCompany" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="setStorehouseSub" />
					</param>
					<param name="listener">
						<attribute name="class" value="SimpleDialogCloseListener" />
					</param>
				</param>
				<property name="SubCompanyForm" class="SubCompanyForm" builder="ViewFieldBuilder">
					<param name="cfg">
						<attribute name="view-name" value="ShowQuery.selectedList" />
						<attribute name="position" value="row" />
					</param>
				</property>
			</property>
			<property name="SelfForm" label0="安装人员" class="OrderTicketForm" builder="EditViewBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
				<param name="menu">
					<attribute name="text" value="确定人员" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
						<attribute name="former" value="selectFormer4User" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="setStorehouseUser" />
					</param>
					<param name="listener">
						<attribute name="class" value="SimpleDialogCloseListener" />
					</param>
				</param>
				<property name="LocationTicketForm" class="LocationTicketForm" builder="ViewFieldBuilder">
					<param name="cfg">
						<attribute name="view-name" value="LocationQuery.selfForm.selectFormer4User.selectedList" />
						<attribute name="position" value="row" />
					</param>
				</property>
			</property>
		</view>
		<view name="TicketCount" label0="按单统计" builder="EditViewBuilder">
			<param name="menu">
				<attribute name="text" value="统计" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ChangeBuilderListener" />
					<attribute name="builder" value="SqlCrossBuilder" />
					<attribute name="properties" value="selectedList" />
				</param>
				<param name="listener">
					<attribute name="class" value="SelectCrossListener" />
					<attribute name="view-name" value="selectedList" />
					<attribute name="former" value="selectCross4OrderTicket" />
				</param>
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4OrderTicket" />
					<attribute name="view-name" value="TicketForm.selectedList" />
					<attribute name="select" value="all" />
					<attribute name="validate" value="false" />
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="getOrderTicketCount" />
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="action" value="OrderTicket_T" />
					<attribute name="setter" value="setOrderCount4Service" />
					<attribute name="message" value="客户订单数量跟踪合计" />
				</param>
				<param name="listener">
					<attribute name="class" value="RefreshListener" />
					<attribute name="view-name" value="TicketForm.selectedList" />
				</param>
			</param>
			<property name="selectedList" label="按单统计明细" class="OrderDetail" builder="SqlListBuilder">
				<param name="cfg">
					<attribute name="row-fields" value="number" />
					<attribute name="rowcount-fields" value="id0|count;amount|sum;cmoney|sum;Arrange|sum;ArrangeC|sum;ArrangeDate|max;Wait|sum;WaitC|sum;WaitDate|max;Receipt|sum;ReceiptC|sum;ReceiptDate|max;Send|sum;SendC|sum;SendDate|max;Paid|sum;PaidC|sum;PaidMoney|sum;WaitMoney|sum;PaidDate|max" />
				</param>
				<fields>
					<field id="id" type="Long" label="选择" expression="c.id" />
					<field id="id0" type="Long" label="订单ID" expression="c.id" />
					<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
					<field id="number" type="String" label="订单号" expression="c.number" />
					<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
					<field id="commName" type="String" label="商品名称" expression="c.commName" />
					<field id="clientName" type="String" label="客户名称" expression="c.clientName" />
					<field id="subName" type="String" label="分公司名称" expression="c.subName" />
					<field id="amount" type="Double" label="数量" expression="c.amount" />
					<field id="stateNotes" type="String" label="流程日志" expression="c.stateNotes" />

					<field id="Arrange" type="String" label="安排数" expression="case when c.arrangeId>=30 then c.amount else 0 end" />
					<field id="ArrangeC" type="String" label="安排项" expression="case when c.arrangeId>=30 then 1 else 0 end" />
					<field id="ArrangeDate" type="String" label="安排日期" expression="case when c.arrangeId>=30 then c.uarrange else null end" />
					<field id="Wait" type="String" label="在途数"><![CDATA[case when c.stPurchase>=30 and c.receiptId<30 then c.amount else 0 end]]></field>
					<field id="WaitC" type="String" label="在途项"><![CDATA[case when c.stPurchase>=30 and c.receiptId<30 then 1 else 0 end]]></field>
					<field id="WaitDate" type="String" label="在途日期"><![CDATA[case when c.stPurchase>=30 and c.receiptId<30 then c.upurchase else null end]]></field>
					<field id="Receipt" type="String" label="待发数" expression="case when c.sendId=20 then c.amount else 0 end" />
					<field id="ReceiptC" type="String" label="待发项" expression="case when c.sendId=20 then 1 else 0 end" />
					<field id="ReceiptDate" type="String" label="待货日期" expression="case when c.sendId=20 and c.stPurchase>0 then c.upurchase when c.sendId=20 and c.stPurchase=0 then c.uarrange else null end" />
					<field id="Send" type="String" label="发货数" expression="case when c.sendId=30 then c.amount else 0 end" />
					<field id="SendC" type="String" label="发货项" expression="case when c.sendId=30 then 1 else 0 end" />
					<field id="SendDate" type="String" label="发货日期" expression="case when c.sendId=30 then c.usend else null end" />
					<field id="Paid" type="String" label="付款数" expression="case when b.stBill=30 then b.amount else 0 end" />
					<field id="PaidC" type="String" label="付款项" expression="case when b.stBill=30 then 1 else 0 end" />
					<field id="PaidMoney" type="String" label="付款额" expression="case when b.stBill=30 then b.money else 0 end" />
					<field id="WaitMoney" type="String" label="待付款额"><![CDATA[case when b.stBill<30 then b.money else 0 end]]></field>
					<field id="PaidDate" type="Date" label="付款日期" expression="case when b.stBill=30 then b.modifytime else null end" />

					<field id="cprice" type="Double" label="订单价" expression="c.cprice" />
					<field id="cmoney" type="Double" label="订单合价" expression="c.cmoney" />
					<field id="supplyType" type="String" label="供货方式" expression="c.supplyType" />
					<field id="proNumber" type="String" label="项目编号" expression="c.proNumber" />
					<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
					<field id="arrangeName" type="String" label="排单名称" expression="c.arrangeName" />
					<field id="sendName" type="String" label="发料名称" expression="c.sendName" />
					<field id="outstore" type="String" label="出货仓" expression="c.outstore" />
					<field id="instore" type="String" label="入货仓" expression="c.instore" />
					<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
					<field id="modifytime" type="Date" label="编辑时间" expression="c.modifytime" />
					<field id="uorder" type="String" label="订单人" expression="c.uorder" />
					<field id="uarrange" type="String" label="排单人" expression="c.uarrange" />
					<field id="stOrder" type="int" label="订单Id" visible="false" expression="c.stOrder" />
					<field id="orderType" type="String" label="订单类型" expression="c.orderType" />
					<field id="arrangeType" type="String" label="安排类型" expression="c.arrangeType" />
					<field id="orderDate" type="Date" label="订单日期" expression="c.orderDate" />
					<field id="hopeDate" type="Date" label="期望出货日期" expression="c.hopeDate" />
					<field id="version" type="int" label="版本" visible="false" expression="c.version" />
				</fields>
				<DataSource><![CDATA[
					from sa_OrderDetail c
					left join sa_BillDetail b on b.sellerId=c.sellerId and b.monthnum=c.monthnum and b.stBill>0 and b.amount=c.amount and b.typeName='销售出货'
				]]></DataSource>
				<Where><![CDATA[
					c.amount>0
				]]></Where>
			</property>
			<property name="TicketForm" label="订单单头" class="OrderTicketForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="ShowQuery.selfForm.TicketForm.selectedList" />
					<attribute name="position" value="row" />
					<attribute name="show-label" value="false" />
				</param>
			</property>
		</view>
	</class>
</mily-mappings>
