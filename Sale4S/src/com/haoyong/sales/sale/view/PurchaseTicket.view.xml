<?xml version="1.0" encoding="UTF-8"?>
<mily-mappings package="com.haoyong.sales.sale.form">
	<import>net.sf.mily.support.form.*</import>
	<import>com.haoyong.sales.common.listener.*</import>
	<import>com.haoyong.sales.sale.domain.*</import>
	<import>com.haoyong.sales.base.domain.*</import>
	<import>com.haoyong.sales.base.form.*</import>
	<class name="PurchaseTicketForm" label="采购单">
		<property name="PurchaseTicket" visible="false" class="PurchaseTicket" builder="EditViewBuilder">
			<property name="Ticket" class="PurchaseTicket">
				<property name="number" label="采购单号" builder="TextFieldBuilder">
					<param name="cfg">
						<attribute name="type" value="Require" />
					</param>
					<param name="button">
						<attribute name="text" value="生成单号" />
						<param name="listener">
							<attribute name="class" value="ChangeAssociateListener" />
							<attribute name="method" value="setPurchaseTicketNumber" />
							<attribute name="properties" value="PurchaseTicket.Ticket" />
						</param>
					</param>
				</property>
				<property name="number2" label="人工编号" builder="TextFieldBuilder"/>
				<property name="purDate" label="采购日期" builder="DateBuilder">
					<param name="cfg">
						<attribute name="type" value="Require" />
					</param>
				</property>
				<property name="hopeDate" label="预计交货期" builder="DateBuilder"/>
				<property name="remark" label="采购备注" builder="TextAreaBuilder">
					<param name="cfg">
						<attribute name="position" value="row" />
					</param>
				</property>
			</property>
			<property name="Handle" class="PurchaseTicket">
				<property name="backupAmount" label="转备料数量" builder="TextFieldBuilder"/>
				<property name="cancelAmount" label="取消数量" builder="TextFieldBuilder"/>
				<property name="rearrangeAmount" label="重排单数量" builder="TextFieldBuilder"/>
				<property name="overAmount" label="多收货数量" builder="TextFieldBuilder"/>
				<property name="Material" label="齐料合计" builder="TextBuilder"/>
			</property>
			<property name="Detail" class="PurchaseTicket">
	        	<property name="taxRate" label="税率%" builder="TextFieldBuilder">
					<param name="listener">
						<attribute name="class" value="SelectRowListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="ChangeAssociateListener" />
						<attribute name="properties" value="price,untaxPrice" />
						<attribute name="method" value="setTaxPrice" />
					</param>
	        	</property>
	        	<property name="untaxPrice" label="无税价" builder="TextFieldBuilder">
					<param name="listener">
						<attribute name="class" value="SelectRowListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="ChangeAssociateListener" />
						<attribute name="properties" value="price,untaxPrice" />
						<attribute name="method" value="setTaxPrice" />
					</param>
	        	</property>
			</property>
		</property>
		<view name="TicketChoose" label="采购单自选" builder="EditViewBuilder">
			<property name="ticketChooseFormer" Class="ChooseFormer" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="Ticket"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
			<property name="detailChooseFormer" Class="ChooseFormer" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="Ticket"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
		</view>
		<view name="PrintModel" label="打印模板" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="position" value="Independent"/>
			</param>
			<property name="PrintModelForm" Class="PrintModelForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="Model"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
		</view>
		<view name="AgentList" label="采购方建档" builder="EditViewBuilder">
			<property name="SupplyTypeForm" Class="SupplyTypeForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="AgentList"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
		</view>
		<view name="CommonList" label="普通开单" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="before" value="beforeWaiting" />
			</param>
			<property name="selfForm" class="PurchaseTicketForm" builder="TabPaneBuilder">
				<property name="TicketForm" label="订单采购" class="PurchaseTicketForm" builder="EditViewBuilder">
					<param name="menu">
						<attribute name="text" value="开单" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Order" />
							<attribute name="view-name" value="orderList" />
							<param name="validate">
								<attribute name="properties" value="commName,uneditable,stOrder,arrangeId" />
								<attribute name="method" value="ticketForm.canTicket" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="method" value="prepareTicket" />
						</param>
						<param name="listener">
							<attribute name="class" value="ForwardListener" />
							<attribute name="view-name" value="Common" />
							<attribute name="target" value="CommonList" />
						</param>
					</param>
					<param name="menu">
						<attribute name="text" value="改单申请" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Order" />
							<attribute name="view-name" value="orderList" />
							<param name="same">
								<attribute name="properties" value="number,clientName,arrangeName" />
								<attribute name="select" value="self" />
							</param>
							<param name="validate">
								<attribute name="properties" value="commName,uneditable,stOrder,arrangeId" />
								<attribute name="method" value="ticketForm.canChange" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="method" value="prepareChange" />
						</param>
						<param name="listener">
							<attribute name="class" value="ForwardListener" />
							<attribute name="view-name" value="Change" />
							<attribute name="target" value="CommonList" />
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener"/>
							<attribute name="setter" value="resetChangeList"/>
						</param>
					</param>
					<param name="menu">
						<attribute name="text" value="改单不通过确认" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Order" />
							<attribute name="view-name" value="orderList" />
							<param name="same">
								<attribute name="properties" value="number,clientName" />
								<attribute name="select" value="self" />
							</param>
							<param name="validate">
								<attribute name="properties" value="commName,stOrder,arrangeId" />
								<attribute name="method" value="ticketForm.canChangeConfirm" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="method" value="prepareChange" />
						</param>
						<param name="listener">
							<attribute name="class" value="ForwardListener" />
							<attribute name="view-name" value="Change" />
							<attribute name="target" value="CommonList" />
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener"/>
							<attribute name="setter" value="resetChangeList"/>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="setter" value="setChangeOptionsDisable" />
						</param>
					</param>
					<property name="orderList" class="OrderDetail" builder="SqlListBuilder">
						<param name="cfg">
							<attribute name="parameter" value="getParam4Supply"/>
						</param>
						<param name="remind">
							<attribute name="id" value="remind"/>
							<attribute name="value" value="=true"/>
						</param>
						<param name="select">
							<attribute name="id" value="GSearch"/>
							<attribute name="value" value="=true"/>
						</param>
						<fields>
							<field id="id" type="Long" label="选择" expression="c.ID" />
							<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
							<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
							<field id="uneditable" type="String" label="可否处理"><![CDATA[case
								when (c.stOrder>=50) then '不可，红冲处理中'
								when (c.stOrder=40) then '不可，订单改单申请审核中'
								when (c.stOrder=42) then '待改单不通过确认'
								when (c.arrangeId=40) then '不可，排单改单审核中'
								when (c.arrangeId=42) then '排单改单不通过确认'
								else null end
								]]></field>
							<field id="commName" type="String" label="商品名称" expression="c.commName" />
							<field id="amount" type="Double" label="数量" expression="c.amount" />
							<field id="number" type="String" label="订单号" expression="c.number" />
							<field id="clientName" type="String" label="客户名称" expression="c.clientName" />
							<field id="subName" type="String" label="分公司名称" expression="c.subName" />
							<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
							<field id="arrangeName" type="String" label="排单名称" expression="c.arrangeName" />
							<field id="stOrder" type="int" label="订单流程状态Id" visible="false" expression="c.stOrder" />
							<field id="arrangeId" type="int" label="排单流程状态Id" visible="false" expression="c.arrangeId" />
							<field id="notes" type="String" label="改单待确认" visible="false" expression="c.notes" />
							<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
							<field id="changeRemark" type="String" label="改单备注" expression="c.changeRemark" />
							<field id="arrangeType" type="String" label="发货方式" expression="c.arrangeType" />
							<field id="uorder" type="String" label="订单人" expression="c.uorder" />
							<field id="remind" type="boolean" label="待处理" visible="false" expression="c.stOrder=42 or c.arrangeId=42" />
							<field id="GSearch" type="boolean" label="全局搜索" visible="false" expression="c.stOrder=30 and c.arrangeId=30" />
							<field id="version" type="int" label="版本" visible="false" expression="c.version" />
						</fields>
						<DataSource><![CDATA[
							from sa_OrderDetail c
						]]>
						</DataSource>
						<Where><![CDATA[
							c.stOrder>=30 and c.arrangeId>=30 and c.sendId=0 and c.supplyType={$supplyType} and c.arrangeType='普通'
						]]>
						</Where>
					</property>
				</property>
			</property>
			<property name="selfForm" class="PurchaseTicketForm" builder="TabPaneBuilder">
				<property name="selfForm" label="原物料采购" class="PurchaseTicketForm" builder="EditViewBuilder">
					<param name="menu">
						<attribute name="text" value="开单" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Bom" />
							<attribute name="view-name" value="selectFormer4Bom.selectedList" />
							<param name="same">
								<attribute name="properties" value="commName" />
								<attribute name="select" value="self" />
							</param>
							<param name="parameter">
								<attribute name="id" value="ordId" />
								<attribute name="version" value="ordVersion" />
								<attribute name="class" value="OrderDetail" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="method" value="prepareTicket4Bom" />
						</param>
						<param name="listener">
							<attribute name="class" value="ForwardListener" />
							<attribute name="view-name" value="BomPurchase" />
							<attribute name="target" value="CommonList" />
						</param>
					</param>
					<param name="menu">
						<attribute name="text" value="同商品开单" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Bom" />
							<attribute name="view-name" value="selectFormer4Bom.selectedList" />
							<param name="same">
								<attribute name="properties" value="commName" />
							</param>
							<param name="parameter">
								<attribute name="id" value="ordId" />
								<attribute name="version" value="ordVersion" />
								<attribute name="class" value="OrderDetail" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="method" value="prepareTicket4Bom" />
						</param>
						<param name="listener">
							<attribute name="class" value="ForwardListener" />
							<attribute name="view-name" value="BomPurchase" />
							<attribute name="target" value="CommonList" />
						</param>
					</param>
					<property name="selectFormer4Bom.selectedList" class="BomDetail" builder="SqlListBuilder">
						<param name="cfg">
							<attribute name="parameter" value="getParam4Supply"/>
						</param>
						<param name="remind">
							<attribute name="id" value="id"/>
							<attribute name="value" value=">0"/>
						</param>
						<param name="select">
							<attribute name="id" value="id"/>
							<attribute name="value" value=">0"/>
						</param>
						<fields>
							<field id="id" type="Long" label="物料ID" expression="b.ID" />
							<field id="bomId" type="Long" label="物料明细ID" visible="false" expression="b.ID" />
							<field id="SellerId" type="Long" label="商家ID" visible="false" expression="b.sellerId" />
							<field id="ordId" type="Long" label="订单ID" visible="false" expression="c.ID" />
							<field id="number" type="String" label="订单号" expression="b.number" />
							<field id="monthnum" type="String" label="月流水号" expression="b.monthnum" />
							<field id="outMonthnum" type="String" label="出库流水" expression="b.outMonthnum" />
							<field id="commNumber" type="String" label="商品编号" expression="b.commNumber" />
							<field id="commName" type="String" label="商品名称" expression="b.commName" />
							<field id="level" type="int" label="BOM层级" expression="b.level" />
							<field id="arrange" type="String" label="物料安排" expression="b.arrange" />
							<field id="ticketAmount" type="Double" label="请购数量" visible="false" expression="b.amount" />
							<field id="amount" type="Double" label="需求数量" expression="b.amount" >
								<param name="footer">
									<attribute name="type" value="SUM" />
									<attribute name="expression" value="sum(b.amount)" />
								</param>
							</field>
							<field id="gotAmount" type="Double" label="配给数量" expression="b.gotAmount" />
							<field id="notAmount" type="Double" label="差额数量" expression="b.notAmount" />
							<field id="clientName" type="String" label="客户名称" expression="b.clientName" />
							<field id="subName" type="String" label="分公司名称" expression="b.subName" />
							<field id="stateName" type="String" label="流程名称" expression="b.stateName" />
							<field id="stBom" type="int" label="物料流程ID" expression="b.stBom" />
							<field id="version" type="int" label="物料版本" visible="false" expression="b.version" />
							<field id="ordVersion" type="int" label="订单版本" visible="false" expression="c.version" />
						</fields>
						<DataSource><![CDATA[
							from sa_BomDetail b
							left join sa_OrderDetail c on c.sellerId=b.sellerId and c.monthnum=b.monthnum
						]]>
						</DataSource>
						<Where><![CDATA[
							b.stBom=10 and b.arrange='去请购' and b.stPurchase=0 and b.supplyType={$supplyType}
						]]>
						</Where>
					</property>
				</property>
			</property>
		</view>
		<view name="DirectList" label="直发开单" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="before" value="beforeWaiting" />
			</param>
			<param name="menu">
				<attribute name="text" value="开单" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Order" />
					<attribute name="view-name" value="orderList" />
					<param name="validate">
						<attribute name="properties" value="commName,uneditable,stOrder,arrangeId" />
						<attribute name="method" value="ticketForm.canTicket" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareTicket" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Direct" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="改单申请" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Order" />
					<attribute name="view-name" value="orderList" />
					<param name="same">
						<attribute name="properties" value="number,clientName" />
						<attribute name="select" value="self" />
					</param>
					<param name="validate">
						<attribute name="properties" value="commName,uneditable,stOrder,arrangeId" />
						<attribute name="method" value="ticketForm.canTicket" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareChange" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Change" />
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="setter" value="resetChangeList"/>
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="改单不通过确认" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Order" />
					<attribute name="view-name" value="orderList" />
					<param name="same">
						<attribute name="properties" value="number,clientName" />
						<attribute name="select" value="self" />
					</param>
					<param name="validate">
						<attribute name="properties" value="commName,stOrder,arrangeId" />
						<attribute name="method" value="ticketForm.canChangeConfirm" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareChange" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Change" />
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="setter" value="resetChangeList"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="setter" value="setChangeOptionsDisable" />
				</param>
			</param>
			<property name="orderList" class="OrderDetail" builder="SqlListBuilder">
				<param name="cfg">
					<attribute name="parameter" value="getParam4Supply"/>
				</param>
				<param name="remind">
					<attribute name="id" value="remind"/>
					<attribute name="value" value="=true"/>
				</param>
				<param name="select">
					<attribute name="id" value="GSearch"/>
					<attribute name="value" value="=true"/>
				</param>
				<fields>
					<field id="id" type="Long" label="选择" expression="c.ID" />
					<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
					<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
					<field id="uneditable" type="String" label="可否处理"><![CDATA[case
						when (c.stOrder>=50) then '不可，红冲处理中'
						when (c.stOrder=40) then '不可，订单改单申请审核中'
						when (c.stOrder=42) then '待改单不通过确认'
						when (c.arrangeId=40) then '不可，排单改单审核中'
						when (c.arrangeId=42) then '排单改单不通过确认'
						else null end
						]]></field>
					<field id="commName" type="String" label="商品名称" expression="c.commName" />
					<field id="amount" type="Double" label="数量" expression="c.amount" />
					<field id="number" type="String" label="订单号" expression="c.number" />
					<field id="clientName" type="String" label="客户名称" expression="c.clientName" />
					<field id="subName" type="String" label="分公司名称" expression="c.subName" />
					<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
					<field id="arrangeName" type="String" label="排单名称" expression="c.arrangeName" />
					<field id="stOrder" type="int" label="订单流程状态Id" visible="false" expression="c.stOrder" />
					<field id="arrangeId" type="int" label="排单流程状态Id" visible="false" expression="c.arrangeId" />
					<field id="notes" type="String" label="改单待确认" visible="false" expression="c.notes" />
					<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
					<field id="changeRemark" type="String" label="改单备注" expression="c.changeRemark" />
					<field id="arrangeType" type="String" label="发货方式" expression="c.arrangeType" />
					<field id="uorder" type="String" label="订单人" expression="c.uorder" />
					<field id="remind" type="boolean" label="待处理" visible="false" expression="c.stOrder=42 or c.arrangeId=42" />
					<field id="GSearch" type="boolean" label="全局搜索" visible="false" expression="c.stOrder=30 and c.arrangeId=30" />
					<field id="version" type="int" label="版本" visible="false" expression="c.version" />
				</fields>
				<DataSource><![CDATA[
					from sa_OrderDetail c
				]]>
				</DataSource>
				<Where><![CDATA[
					c.stOrder>=30 and c.arrangeId>=30 and c.sendId=0 and c.supplyType={$supplyType} and c.arrangeType='直发'
				]]>
				</Where>
			</property>
		</view>
		<view name="LocalList" label="当地购开单" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="before" value="beforeWaiting" />
			</param>
			<property name="selfForm" class="PurchaseTicketForm" builder="TabPaneBuilder">
				<property name="selfForm" label="当地购开单" class="PurchaseTicketForm" builder="EditViewBuilder">
					<param name="menu">
						<attribute name="text" value="开单" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Order" />
							<attribute name="view-name" value="orderList" />
							<param name="validate">
								<attribute name="properties" value="commName,uneditable,stOrder,arrangeId" />
								<attribute name="method" value="ticketForm.canTicket" />
							</param>
							<param name="same">
								<attribute name="properties" value="fromSellerId" />
								<attribute name="select" value="self" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="method" value="prepareTicket" />
						</param>
						<param name="listener">
							<attribute name="class" value="ForwardListener" />
							<attribute name="view-name" value="Local" />
							<attribute name="target" value="LocalList" />
						</param>
					</param>
					<param name="menu">
						<attribute name="text" value="开单不通过确认" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Purchase" />
							<attribute name="view-name" value="orderList" />
							<param name="validate">
								<attribute name="properties" value="commName,stPurchase" />
								<attribute name="method" value="ticketForm.canLocalConfirm" />
							</param>
							<param name="same">
								<attribute name="properties" value="purName" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="method" value="prepareLocalAudit" />
						</param>
						<param name="listener">
							<attribute name="class" value="ForwardListener" />
							<attribute name="view-name" value="Local" />
							<attribute name="target" value="LocalList" />
						</param>
					</param>
					<param name="menu">
						<attribute name="text" value="改单申请" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Order" />
							<attribute name="view-name" value="orderList" />
							<param name="same">
								<attribute name="properties" value="number,clientName" />
								<attribute name="select" value="self" />
							</param>
							<param name="validate">
								<attribute name="properties" value="commName,uneditable,stOrder,arrangeId" />
								<attribute name="method" value="ticketForm.canTicket" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="method" value="prepareChange" />
						</param>
						<param name="listener">
							<attribute name="class" value="ForwardListener" />
							<attribute name="view-name" value="Change" />
							<attribute name="target" value="LocalList" />
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener"/>
							<attribute name="setter" value="resetChangeList"/>
						</param>
					</param>
					<param name="menu">
						<attribute name="text" value="改单不通过确认" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Order" />
							<attribute name="view-name" value="orderList" />
							<param name="same">
								<attribute name="properties" value="number,clientName" />
								<attribute name="select" value="self" />
							</param>
							<param name="validate">
								<attribute name="properties" value="commName,stOrder,arrangeId" />
								<attribute name="method" value="ticketForm.canChangeConfirm" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="method" value="prepareChange" />
						</param>
						<param name="listener">
							<attribute name="class" value="ForwardListener" />
							<attribute name="view-name" value="Change" />
							<attribute name="target" value="LocalList" />
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener"/>
							<attribute name="setter" value="resetChangeList"/>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="setter" value="setChangeOptionsDisable" />
						</param>
					</param>
					<property name="orderList" class="OrderDetail" builder="SqlListBuilder">
						<param name="cfg">
							<attribute name="parameter" value="getParam4Supply"/>
						</param>
						<param name="remind">
							<attribute name="id" value="remind"/>
							<attribute name="value" value="=true"/>
						</param>
						<param name="select">
							<attribute name="id" value="GSearch"/>
							<attribute name="value" value="=true"/>
						</param>
						<fields>
							<field id="id" type="Long" label="选择" expression="c.ID" />
							<field id="SellerId" type="Long" label="当地商家ID" visible="false"><![CDATA[case when c.fromSellerId>0 then c.fromSellerId else c.sellerId end]]></field>
							<field id="fromSellerId" type="Long" label="当地商家ID" visible="false" expression="c.fromSellerId" />
							<field id="number" type="String" label="订单号" expression="c.number" />
							<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
							<field id="commName" type="String" label="商品名称" expression="c.commName" />
							<field id="uneditable" type="String" label="可否处理"><![CDATA[case
								when (c.stPurchase=10) then '待当地购不通过确认'
								when (c.stOrder>=50) then '不可，红冲处理中'
								when (c.stOrder=40) then '不可，订单改单申请审核中'
								when (c.stOrder=42) then '待订单改单不通过确认'
								when (c.arrangeId=40) then '不可，排单改单审核中'
								when (c.arrangeId=42) then '待排单改单不通过确认'
								else null end
								]]></field>
							<field id="amount" type="Double" label="数量" expression="c.amount" />
							<field id="clientName" type="String" label="客户名称" expression="c.clientName" />
							<field id="subName" type="String" label="分公司名称" expression="c.subName" />
							<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
							<field id="arrangeName" type="String" label="排单名称" expression="c.arrangeName" />
							<field id="purName" type="String" label="采购名称" expression="c.purName" />
							<field id="stOrder" type="int" label="订单流程状态Id" visible="false" expression="c.stOrder" />
							<field id="stPurchase" type="int" label="采购流程状态Id" visible="false" expression="c.stPurchase" />
							<field id="arrangeId" type="int" label="排单流程状态Id" visible="false" expression="c.arrangeId" />
							<field id="notes" type="String" label="改单待确认" visible="false" expression="c.notes" />
							<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
							<field id="changeRemark" type="String" label="改单备注" expression="c.changeRemark" />
							<field id="arrangeType" type="String" label="发货方式" expression="c.arrangeType" />
							<field id="uorder" type="String" label="订单人" expression="c.uorder" />
							<field id="remind" type="boolean" label="待处理" visible="false" expression="c.stOrder=42 or c.arrangeId=42" />
							<field id="GSearch" type="boolean" label="全局搜索" visible="false" expression="c.stOrder=30 and c.arrangeId=30" />
							<field id="version" type="int" label="订单版本" visible="false" expression="c.version" />
						</fields>
						<DataSource><![CDATA[
							from sa_OrderDetail c
						]]>
						</DataSource>
						<Where><![CDATA[
							c.stOrder>=30 and c.arrangeId>=30 and (c.stPurchase=0 or c.stPurchase=10) and c.sendId=0 and c.supplyType={$supplyType} and c.arrangeType='当地购'
						]]>
						</Where>
					</property>
				</property>
			</property>
			<property name="selfForm" class="PurchaseTicketForm" builder="TabPaneBuilder">
				<property name="selfForm" label="当地购审核" class="PurchaseTicketForm" builder="EditViewBuilder">
					<param name="menu">
						<attribute name="text" value="审核" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Purchase" />
							<attribute name="view-name" value="selectFormer4Purchase.selectedList" />
							<param name="validate">
								<attribute name="properties" value="commName,uneditable,stOrder,arrangeId" />
								<attribute name="method" value="ticketForm.canTicket" />
							</param>
							<param name="same">
								<attribute name="properties" value="purName" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="PostListener" />
							<attribute name="method" value="prepareLocalAudit" />
						</param>
						<param name="listener">
							<attribute name="class" value="ForwardListener" />
							<attribute name="view-name" value="LocalAudit" />
							<attribute name="target" value="LocalList" />
						</param>
					</param>
					<property name="selectFormer4Purchase.selectedList" class="OrderDetail" builder="SqlListBuilder">
						<param name="cfg">
							<attribute name="parameter" value="getParam4Supply"/>
						</param>
						<fields>
							<field id="id" type="Long" label="选择" expression="c.ID" />
							<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
							<field id="number" type="String" label="订单号" expression="c.number" />
							<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
							<field id="uaccept" type="String" label="接单商家" expression="c.uaccept" />
							<field id="commName" type="String" label="商品名称" expression="c.commName" />
							<field id="uneditable" type="String" label="可否处理"><![CDATA[case
								when (c.stOrder>=50) then '不可，红冲处理中'
								when (c.stOrder=40) then '不可，订单改单申请审核中'
								when (c.stOrder=42) then '待改单不通过确认'
								when (c.arrangeId=40) then '不可，排单改单审核中'
								when (c.arrangeId=42) then '排单改单不通过确认'
								else null end
								]]></field>
							<field id="amount" type="Double" label="数量" expression="c.amount" />
							<field id="price" type="Double" label="采购价" expression="c.price" />
							<field id="clientName" type="String" label="客户名称" expression="c.clientName" />
							<field id="subName" type="String" label="分公司名称" expression="c.subName" />
							<field id="supplyType" type="String" label="供货方式" expression="c.supplyType" />
							<field id="proNumber" type="String" label="项目编号" expression="c.proNumber" />
							<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
							<field id="arrangeName" type="String" label="排单名称" expression="c.arrangeName" />
							<field id="purName" type="String" label="采购名称" expression="c.purName" />
							<field id="sendName" type="String" label="发料名称" expression="c.sendName" />
							<field id="outstore" type="String" label="出货仓" expression="c.outstore" />
							<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
							<field id="modifytime" type="Date" label="编辑时间" expression="c.modifytime" />
							<field id="uorder" type="String" label="订单人" expression="c.uorder" />
							<field id="orderType" type="String" label="订单类型" visible="false" expression="c.orderType" />
							<field id="stOrder" type="int" label="订单Id" visible="false" expression="c.stOrder" />
							<field id="arrangeId" type="int" label="排单流程状态Id" visible="false" expression="c.arrangeId" />
							<field id="version" type="int" label="订单版本" visible="false" expression="c.version" />
						</fields>
						<DataSource><![CDATA[
							from sa_OrderDetail c
						]]>
						</DataSource>
						<Where><![CDATA[
							c.stOrder>=30 and c.arrangeId>=30 and c.stPurchase=20 and c.sendId=0 and c.supplyType={$supplyType} and c.arrangeType='当地购'
						]]>
						</Where>
					</property>
				</property>
			</property>
		</view>
		<view name="RechangeList" label="返改单处理" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="before" value="beforeWaiting" />
			</param>
			<param name="menu">
				<attribute name="text" value="改单处理" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
					<param name="same">
						<attribute name="properties" value="number,clientName,changeRemark,receiptName,receiptName2,notes" />
						<attribute name="select" value="self" />
					</param>
					<param name="validate">
						<attribute name="properties" value="commName,stPurchase,stOrder,arrangeId" />
						<attribute name="method" value="ticketForm.canRechange" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareRechange" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Rechange" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="供应商返单处理" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
					<param name="same">
						<attribute name="properties" value="purName,changeRemark" />
					</param>
					<param name="validate">
						<attribute name="properties" value="commName,stPurchase" />
						<attribute name="method" value="ticketForm.canRepurchase" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareRepurchase" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Repurchase" />
				</param>
			</param>
			<property name="selectedList" class="OrderDetail" builder="SqlListBuilder">
				<param name="cfg">
					<attribute name="parameter" value="getParam4Supply"/>
				</param>
				<param name="remind">
					<attribute name="id" value="id"/>
					<attribute name="value" value=">0"/>
				</param>
				<param name="select">
					<attribute name="id" value="id"/>
					<attribute name="value" value=">0"/>
				</param>
				<fields>
					<field id="id" type="Long" label="选择" expression="c.ID" />
					<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
					<field id="number" type="String" label="订单号" expression="c.number" />
					<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
					<field id="purName" type="String" label="采购名称" expression="c.purName" />
					<field id="uneditable" type="String" label="是否可处理" expression="case
						when (c.stPurchase=20) then '供应商返单处理'
						when (c.stPurchase=40) then '待改单处理'
						when (c.stOrder=45 or c.arrangeId=45) then '待改单不同意处理'
						else null end" />
					<field id="commName" type="String" label="商品名称" expression="c.commName" />
					<field id="amount" type="Double" label="数量" expression="c.amount" />
					<field id="price" type="Double" label="采购价" expression="c.price" />
					<field id="supplierName" type="String" label="供应商名称" expression="c.supplierName" />
					<field id="clientName" type="String" label="客户名称" expression="c.clientName" />
					<field id="subName" type="String" label="分公司名称" expression="c.subName" />
					<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
					<field id="arrangeName" type="String" label="排单名称" expression="c.arrangeName" />
					<field id="receiptName" type="String" label="收货名称" expression="c.receiptName" />
					<field id="receiptName2" type="String" label="收货名称2" expression="c.receiptName2" />
					<field id="stPurchase" type="int" label="采购流程状态Id" visible="false" expression="c.stPurchase" />
					<field id="stOrder" type="int" label="订单状态Id" visible="false" expression="c.stOrder" />
					<field id="arrangeId" type="int" label="订单排单状态Id" visible="false" expression="c.arrangeId" />
					<field id="notes" type="String" label="改单待确认" visible="false" expression="c.notes" />
					<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
					<field id="changeRemark" type="String" label="改单备注" expression="c.changeRemark" />
					<field id="arrangeType" type="String" label="安排方式" expression="c.arrangeType" />
					<field id="upurchase" type="String" label="采购人" expression="c.upurchase" />
					<field id="receiptId" type="int" label="收货状态ID" visible="false" expression="c.receiptId" />
					<field id="version" type="int" label="版本" visible="false" expression="c.version" />
				</fields>
				<DataSource><![CDATA[
					from sa_OrderDetail c
				]]>
				</DataSource>
				<Where><![CDATA[
					c.supplyType={$supplyType} and
					(c.stPurchase=20 or c.stPurchase=40 or c.stOrder=45 or c.arrangeId=45)
				]]>
				</Where>
			</property>
		</view>
		<view name="AdjustList" label="红冲处理" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="before" value="beforeWaiting" />
			</param>
			<param name="menu">
				<attribute name="text" value="红冲处理" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Order" />
					<attribute name="view-name" value="selectedList" />
					<param name="same">
						<attribute name="properties" value="number,clientName,stOrder,arrangeId" />
						<attribute name="select" value="self" />
					</param>
					<param name="validate">
						<attribute name="properties" value="commName,stOrder,arrangeId" />
						<attribute name="method" value="ticketForm.canAdjust" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareAdjust" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Adjust" />
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="setter" value="resetAdjusting"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="setter" value="setAdjustOptionsDisable" />
				</param>
			</param>
			<property name="selectedList" class="OrderDetail" builder="SqlListBuilder">
				<param name="cfg">
					<attribute name="parameter" value="getParam4Supply"/>
				</param>
				<param name="remind">
					<attribute name="id" value="id"/>
					<attribute name="value" value=">0"/>
				</param>
				<param name="select">
					<attribute name="id" value="id"/>
					<attribute name="value" value=">0"/>
				</param>
				<fields>
					<field id="id" type="Long" label="选择" expression="c.ID" />
					<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
					<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
					<field id="purName" type="String" label="采购名称" expression="c.purName" />
					<field id="uneditable" type="String" label="是否可处理" expression="case
						when (c.stOrder=50) then '待订单红冲处理'
						when (c.arrangeId=50) then '待排单红冲处理'
						else null end" />
					<field id="commName" type="String" label="商品名称" expression="c.commName" />
					<field id="amount" type="Double" label="数量" expression="c.amount" />
					<field id="price" type="Double" label="采购价" expression="c.price" />
					<field id="supplierName" type="String" label="供应商名称" expression="c.supplierName" />
					<field id="number" type="String" label="订单编号" expression="c.number" />
					<field id="clientName" type="String" label="客户名称" expression="c.clientName" />
					<field id="subName" type="String" label="分公司名称" expression="c.subName" />
					<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
					<field id="arrangeName" type="String" label="排单名称" expression="c.arrangeName" />
					<field id="stPurchase" type="int" label="采购流程状态Id" visible="false" expression="c.stPurchase" />
					<field id="stOrder" type="int" label="订单状态Id" visible="false" expression="c.stOrder" />
					<field id="arrangeId" type="int" label="订单排单状态Id" visible="false" expression="c.arrangeId" />
					<field id="notes" type="String" label="改单待确认" visible="false" expression="c.notes" />
					<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
					<field id="changeRemark" type="String" label="改单备注" expression="c.changeRemark" />
					<field id="arrangeType" type="String" label="发货方式" expression="c.arrangeType" />
					<field id="upurchase" type="String" label="采购人" expression="c.upurchase" />
					<field id="receiptId" type="int" label="收货状态ID" visible="false" expression="c.receiptId" />
					<field id="version" type="int" label="版本" visible="false" expression="c.version" />
				</fields>
				<DataSource><![CDATA[
					from sa_OrderDetail c
				]]>
				</DataSource>
				<Where><![CDATA[
					(c.stOrder=50 or c.arrangeId=50) and c.receiptId=0 and c.supplyType={$supplyType}
				]]>
				</Where>
			</property>
		</view>
		<view name="DoadjustList" label="红冲申请" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="before" value="beforeWaiting" />
			</param>
			<param name="menu">
				<attribute name="text" value="未收货编辑" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
					<param name="same">
						<attribute name="properties" value="purName,supplierName" />
						<attribute name="select" value="self" />
					</param>
					<param name="validate">
						<attribute name="properties" value="commName,stPurchase,receiptId" />
						<attribute name="method" value="ticketForm.canReedit" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareDoadjust" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Reedit" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="红冲申请" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
					<param name="same">
						<attribute name="properties" value="purName,supplierName" />
						<attribute name="select" value="self" />
					</param>
					<param name="validate">
						<attribute name="properties" value="commName,stPurchase,receiptId" />
						<attribute name="method" value="ticketForm.canDoadjust" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareDoadjust" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Doadjust" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="红冲不通过确认" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
					<param name="same">
						<attribute name="properties" value="purName,supplierName" />
						<attribute name="select" value="self" />
					</param>
					<param name="validate">
						<attribute name="properties" value="commName,stPurchase" />
						<attribute name="method" value="ticketForm.canDoadjustConfirm" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareDoadjust" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Doadjust" />
				</param>
			</param>
			<property name="selectedList" class="OrderDetail" builder="SqlListBuilder">
				<param name="cfg">
					<attribute name="parameter" value="getParam4Supply"/>
				</param>
				<param name="remind">
					<attribute name="id" value="stPurchase"/>
					<attribute name="value" value="=52"/>
				</param>
				<param name="select">
					<attribute name="id" value="stPurchase"/>
					<attribute name="value" value="=52"/>
				</param>
				<fields>
					<field id="id" type="Long" label="选择" expression="c.ID" />
					<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
					<field id="number" type="String" label="订单号" expression="c.number" />
					<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
					<field id="purName" type="String" label="采购名称" expression="c.purName" />
					<field id="uneditable" type="String" label="是否可处理" expression="case
						when (c.stPurchase=52) then '待红冲不通过确认'
						when (c.stPurchase=40 || c.stPurchase=42) then '不可，改单申请中'
						else null end" />
					<field id="commName" type="String" label="商品名称" expression="c.commName" />
					<field id="amount" type="Double" label="数量" expression="c.amount" />
					<field id="price" type="Double" label="采购价" expression="c.price" />
					<field id="supplierName" type="String" label="供应商名称" expression="c.supplierName" />
					<field id="receiptName" type="String" label="收货名称" expression="c.receiptName" />
					<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
					<field id="clientName" type="String" label="客户名称" expression="c.clientName" />
					<field id="subName" type="String" label="分公司名称" expression="c.subName" />
					<field id="arrangeName" type="String" label="排单名称" expression="c.arrangeName" />
					<field id="stPurchase" type="int" label="流程状态Id" visible="false" expression="c.stPurchase" />
					<field id="notes" type="String" label="改单待确认" visible="false" expression="c.notes" />
					<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
					<field id="changeRemark" type="String" label="改单备注" expression="c.changeRemark" />
					<field id="arrangeType" type="String" label="发货方式" expression="c.arrangeType" />
					<field id="upurchase" type="String" label="采购人" expression="c.upurchase" />
					<field id="receiptId" type="int" label="收货状态ID" visible="false" expression="c.receiptId" />
					<field id="version" type="int" label="版本" visible="false" expression="c.version" />
				</fields>
				<DataSource><![CDATA[
					from sa_OrderDetail c
				]]>
				</DataSource>
				<Where><![CDATA[
					(c.stPurchase=30 or c.stPurchase=52) and c.supplyType={$supplyType}
				]]>
				</Where>
			</property>
		</view>
		<view name="CancelList" label="取消审核" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="before" value="beforeWaiting" />
			</param>
			<param name="menu">
				<attribute name="text" value="同意" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
					<param name="validate">
						<attribute name="properties" value="commName,stOrder" />
						<attribute name="method" value="ticketForm.canCancelYes" />
					</param>
					<param name="same">
						<attribute name="properties" value="purName,supplierName" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="action" value="OrderTicket_Save" />
					<attribute name="message0" value="Client链接供应商家change客户订单，准备开红冲申请草稿，验证" />
					<attribute name="setter" value="setCancelLink4Service_validate" />
					<attribute name="type" value="UnTransaction" />
					<param name="expression">
						<attribute name="expression" value="supplier.toSellerId>0 and supplier.toSellerId!=sellerId" />
						<attribute name="property" value="selectFormer4Purchase.First"/>
					</param>
					<param name="before">
						<attribute name="method" value="SelectOrderLink.actionBefore" />
					</param>
					<param name="after">
						<attribute name="method" value="ActionService4LinkListener.actionAfter" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="message" value="采购取消审核通过，采购单停止" />
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Save" />
						<attribute name="setter" value="setCancelYes4Service" />
						<attribute name="message" value="采购取消审核通过" />
						<param name="state">
							<attribute name="id" value="0" />
							<attribute name="name" value="取消采购" />
							<attribute name="method" value="setPurchaseState" />
						</param>
						<param name="user">
							<attribute name="method" value="addCancelUser" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="message" value="Client链接供应商家change客户订单，开红冲申请草稿" />
						<attribute name="setter" value="setCancelLink4Service" />
						<param name="expression">
							<attribute name="expression" value="supplier.toSellerId>0 and supplier.toSellerId!=sellerId" />
							<attribute name="property" value="selectFormer4Purchase.First"/>
						</param>
						<param name="before">
							<attribute name="method" value="SelectOrderLink.actionBefore" />
						</param>
						<param name="after">
							<attribute name="method" value="ActionService4LinkListener.actionAfter" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Effect" />
						<attribute name="setter" value="setCancel4Service" />
						<attribute name="message" value="重新计算够用数" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Count" />
						<attribute name="property" value="SelectFormer4Purchase.selectedList" />
						<attribute name="message" value="订单全单统计" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="RefreshListener" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="不同意" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
					<param name="validate">
						<attribute name="properties" value="commName,stOrder" />
						<attribute name="method" value="ticketForm.canCancelYes" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="message" value="不同意取消，按备料继续采购" />
					<attribute name="action" value="PurchaseTicket_Save" />
					<attribute name="setter" value="setCancel4Service" />
					<param name="state">
						<attribute name="id" value="30" />
						<attribute name="name" value="不同意采购取消" />
						<attribute name="method" value="setPurchaseState" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="RefreshListener" />
				</param>
			</param>
			<property name="orderDetail" class="OrderDetail">
				<property name="amount" label="拆分订单数量" builder="TextFieldBuilder" >
					<param name="validate">
						<attribute name="validate"><![CDATA[eval(this.value)>0]]></attribute>
						<attribute name="message" value="拆分数量要大于0" />
					</param>
					<param name="button">
						<attribute name="text" value="拆分出数量" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Purchase" />
							<attribute name="view-name" value="selectedList" />
							<param name="validate">
								<attribute name="properties" value="commName,amount" />
								<attribute name="method" value="ticketForm.canSplit" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="ActionServiceListener" />
							<attribute name="message" value="确认在采购取消审核拆分出此数量的订单连同采购单" />
							<param name="action">
								<attribute name="action" value="PurchaseTicket_Save" />
								<attribute name="setter" value="setSplitNew4Service" />
								<attribute name="message" value="拆分出数量记新采购，用新月流水号" />
							</param>
							<param name="action">
								<attribute name="action" value="PurchaseTicket_Save" />
								<attribute name="setter" value="setSplitRemain4Service" />
								<attribute name="message" value="拆分剩余数量记原采购单" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="RefreshListener" />
							<attribute name="before" value="clearOrder" />
						</param>
					</param>
				</property>
			</property>
			<property name="selectedList" class="OrderDetail" builder="SqlListBuilder">
				<param name="cfg">
					<attribute name="parameter" value="getParam4Supply"/>
				</param>
				<param name="remind">
					<attribute name="id" value="id"/>
					<attribute name="value" value=">0"/>
				</param>
				<param name="select">
					<attribute name="id" value="id"/>
					<attribute name="value" value=">0"/>
				</param>
				<fields>
					<field id="id" type="Long" label="选择" expression="c.ID" />
					<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
					<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
					<field id="purName" type="String" label="采购名称" expression="c.purName" />
					<field id="commName" type="String" label="商品名称" expression="c.commName" />
					<field id="amount" type="Double" label="数量" expression="c.amount" />
					<field id="price" type="Double" label="采购价" expression="c.price" />
					<field id="supplierName" type="String" label="供应商名称" expression="c.supplierName" />
					<field id="stPurchase" type="int" label="采购流程状态Id" visible="false" expression="c.stPurchase" />
					<field id="stOrder" type="int" label="订单状态Id" visible="false" expression="c.stOrder" />
					<field id="arrangeId" type="int" label="订单排单状态Id" visible="false" expression="c.arrangeId" />
					<field id="notes" type="String" label="改单待确认" visible="false" expression="c.notes" />
					<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
					<field id="arrangeType" type="String" label="发货方式" expression="c.arrangeType" />
					<field id="upurchase" type="String" label="采购人" expression="c.upurchase" />
					<field id="modifytime" type="DateTime" label="编辑时间" expression="c.modifytime" />
					<field id="receiptId" type="int" label="收货状态ID" visible="false" expression="c.receiptId" />
					<field id="version" type="int" label="版本" visible="false" expression="c.version" />
				</fields>
				<DataSource><![CDATA[
					from sa_OrderDetail c
				]]>
				</DataSource>
				<Where><![CDATA[
					c.stPurchase=60 and c.receiptId=0 and c.supplyType={$supplyType}
				]]>
				</Where>
			</property>
		</view>
		<view name="ReturnList" label="退货审核" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="before" value="beforeWaiting" />
			</param>
			<param name="menu">
				<attribute name="text" value="同意" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
					<param name="validate">
						<attribute name="properties" value="commName,stOrder" />
						<attribute name="method" value="ticketForm.canReturnYes" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="message" value="采购退货审核通过，下一步仓库退还货物" />
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Save" />
						<attribute name="setter" value="setReturn4Service" />
						<attribute name="message" value="采购退货审核通过" />
						<param name="state">
							<attribute name="id" value="75" />
							<attribute name="name" value="采购同意退货" />
							<attribute name="method" value="setPurchaseState" />
						</param>
						<param name="user">
							<attribute name="method" value="addReturnUser" />
						</param>
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Count" />
						<attribute name="property" value="SelectFormer4Purchase.selectedList" />
						<attribute name="message" value="订单全单统计" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="RefreshListener" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="不同意" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
					<param name="validate">
						<attribute name="properties" value="commName,stOrder" />
						<attribute name="method" value="ticketForm.canReturnYes" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="message" value="采购不同意退货，按备料继续采购" />
					<attribute name="action" value="PurchaseTicket_Save" />
					<attribute name="setter" value="setReturn4Service" />
					<param name="state">
						<attribute name="id" value="72" />
						<attribute name="name" value="采购不同意退货" />
						<attribute name="method" value="setPurchaseState" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="RefreshListener" />
				</param>
			</param>
			<property name="OrderDetail" class="OrderDetail">
				<property name="amount" label="拆分订单数量" builder="TextFieldBuilder" >
					<param name="validate">
						<attribute name="validate"><![CDATA[eval(this.value)>0]]></attribute>
						<attribute name="message" value="拆分数量要大于0" />
					</param>
					<param name="button">
						<attribute name="text" value="拆分出数量" />
						<attribute name="image" value="mily/img/color.gif" />
						<param name="listener">
							<attribute name="class" value="SelectDomainListener" />
							<attribute name="former" value="selectFormer4Purchase" />
							<attribute name="view-name" value="selectedList" />
							<param name="validate">
								<attribute name="properties" value="commName,amount" />
								<attribute name="method" value="ticketForm.canSplit" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="ActionServiceListener" />
							<attribute name="message" value="确认在采购退货审核拆分出此数量的订单连同采购单" />
							<param name="action">
								<attribute name="action" value="PurchaseTicket_Save" />
								<attribute name="setter" value="setSplitNew4Service" />
								<attribute name="message" value="拆分出数量记新采购，用新月流水号" />
							</param>
							<param name="action">
								<attribute name="action" value="PurchaseTicket_Save" />
								<attribute name="setter" value="setSplitRemain4Service" />
								<attribute name="message" value="拆分剩余数量记原采购单" />
							</param>
						</param>
						<param name="listener">
							<attribute name="class" value="RefreshListener" />
							<attribute name="before" value="clearOrder" />
						</param>
					</param>
				</property>
			</property>
			<property name="selectedList" class="OrderDetail" builder="SqlListBuilder">
				<param name="cfg">
					<attribute name="parameter" value="getParam4Supply"/>
				</param>
				<param name="remind">
					<attribute name="id" value="id"/>
					<attribute name="value" value=">0"/>
				</param>
				<param name="select">
					<attribute name="id" value="id"/>
					<attribute name="value" value=">0"/>
				</param>
				<fields>
					<field id="id" type="Long" label="选择" expression="c.ID" />
					<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
					<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
					<field id="purName" type="String" label="采购名称" expression="c.purName" />
					<field id="commName" type="String" label="商品名称" expression="c.commName" />
					<field id="amount" type="Double" label="数量" expression="c.amount" />
					<field id="price" type="Double" label="采购价" expression="c.price" />
					<field id="supplierName" type="String" label="供应商名称" expression="c.supplierName" />
					<field id="returnName" type="String" label="退货名称" expression="CONCAT_WS(',',c.returnName,c.returnOther)" />
					<field id="changeRemark" type="String" label="退货原因" expression="c.changeRemark" />
					<field id="stPurchase" type="int" label="采购流程状态Id" visible="false" expression="c.stPurchase" />
					<field id="stOrder" type="int" label="订单状态Id" visible="false" expression="c.stOrder" />
					<field id="arrangeId" type="int" label="订单排单状态Id" visible="false" expression="c.arrangeId" />
					<field id="notes" type="String" label="改单待确认" visible="false" expression="c.notes" />
					<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
					<field id="arrangeType" type="String" label="发货方式" expression="c.arrangeType" />
					<field id="upurchase" type="String" label="采购人" expression="c.upurchase" />
					<field id="modifytime" type="DateTime" label="编辑时间" expression="c.modifytime" />
					<field id="orderType" type="String" label="订单类型" visible="false" expression="c.orderType" />
					<field id="receiptId" type="int" label="收货状态ID" visible="false" expression="c.receiptId" />
					<field id="version" type="int" label="版本" visible="false" expression="c.version" />
				</fields>
				<DataSource><![CDATA[
					from sa_OrderDetail c
				]]>
				</DataSource>
				<Where><![CDATA[
					c.stPurchase=70 and c.supplyType={$supplyType}
				]]>
				</Where>
			</property>
		</view>
		<view name="ShowQuery" builder="EditViewBuilder">
			<param name="menu">
				<attribute name="text" value="查看" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
					<param name="same">
						<attribute name="properties" value="purName,supplierName" />
						<attribute name="select" value="self" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareShowQuery" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="ShowQuery" />
				</param>
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
					<attribute name="select" value="all" />
					<attribute name="validate" value="false" />
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="prepareShow" />
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="view-name" value="Show" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="打印" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
					<param name="same">
						<attribute name="properties" value="purName,supplierName" />
						<attribute name="select" value="all" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="setter" value="preparePrint" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="选择采购" />
				<attribute name="image" value="mily/img/color.gif" />
				<attribute name="show" value="false" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="former" value="selectFormer4Purchase" />
					<attribute name="view-name" value="selectedList" />
				</param>
			</param>
			<property name="selectedList" class="OrderDetail" builder="SqlListBuilder">
				<param name="cfg">
					<attribute name="parameter" value="getParam4Supply"/>
				</param>
				<fields>
					<field id="id" type="Long" label="选择" expression="c.ID" />
					<field id="SellerId" type="Long" label="商家ID" visible="false" expression="c.sellerId" />
					<field id="monthnum" type="String" label="月流水号" expression="c.monthnum" />
					<field id="number" type="String" label="订单号" expression="c.number" >
						<param name="format">
							<attribute name="properties" value="number,stOrder" />
							<attribute name="method" value="getColumnOrder" />
						</param>
					</field>
					<field id="orderName" type="String" label="订单名称" expression="CONCAT_WS(',',c.orderName,c.orderType,c.orderName2)" />
					<field id="commNumber" type="String" label="商品编号" expression="c.commNumber"/>
					<field id="commName" type="String" label="商品名称" expression="c.commName" />
					<field id="amount" type="Double" label="数量" expression="c.amount" >
						<param name="footer">
							<attribute name="type" value="SUM" />
							<attribute name="expression" value="sum(c.amount)" />
						</param>
					</field>
					<field id="purName" type="String" label="采购名称" expression="c.purName" />
					<field id="price" type="Double" label="采购价" expression="c.price" />
					<field id="pmoney" type="Double" label="采购合价" expression="c.pmoney" >
						<param name="footer">
							<attribute name="type" value="SUM" />
							<attribute name="expression" value="sum(c.pmoney)" />
						</param>
					</field>
					<field id="supplierName" type="String" label="供应商名称" expression="c.supplierName" />
					<field id="receiptName" type="String" label="收货名称" expression="c.receiptName" />
					<field id="instore" type="String" label="库存分账" expression="c.instore" />
					<field id="arrangeName" type="String" label="排单名称" expression="c.arrangeName" />
					<field id="locationName" type="String" label="分账名称" expression="c.locationName" />
					<field id="returnName" type="String" label="退货名称" expression="c.returnName" />
					<field id="stPurchase0" type="int" label="采购状态" expression="case when (c.stPurchase=0 and c.receiptId=0) then '失效' else null end" />
					<field id="stPurchase" type="int" label="采购状态Id" visible="false" expression="c.stPurchase" />
					<field id="stOrder" type="int" label="订单状态Id" visible="false" expression="c.stOrder" />
					<field id="stateName" type="String" label="流程状态" expression="c.stateName" />
					<field id="changeRemark" type="String" label="改单备注" expression="c.changeRemark" />
					<field id="arrangeType" type="String" label="发货方式" expression="c.arrangeType" />
					<field id="upurchase" type="String" label="采购人" expression="c.upurchase" />
					<field id="orderType" type="String" label="订单类型" visible="false" expression="c.orderType" />
					<field id="modifytime" type="DateTime" label="编辑时间" expression="c.modifytime" />
					<field id="receiptId" type="int" label="收货ID" visible="false" expression="c.receiptId" />
					<field id="version" type="int" label="采购版本" visible="false" expression="c.version" />
				</fields>
				<DataSource><![CDATA[
					from sa_OrderDetail c
				]]>
				</DataSource>
				<Where><![CDATA[
					c.supplyType={$supplyType}
				]]>
				</Where>
			</property>
		</view>
		<view name="SupplierQuery" builder="EditViewBuilder">
			<param name="menu">
				<attribute name="text" value="确定" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="setter" value="setSupplierSelect" />
					<attribute name="view-name" value="selectedList"/>
				</param>
				<param name="listener">
					<attribute name="class" value="SimpleDialogCloseListener" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="关闭" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SimpleDialogCloseListener" />
				</param>
			</param>
			<property name="supplierForm" class="SupplierForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="SupplierQuery"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
		</view>
		<view name="CommodityQuery" builder="EditViewBuilder">
			<param name="menu">
				<attribute name="text" value="确定" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SelectDomainListener" />
					<attribute name="setter" value="setCommoditySelect" />
					<attribute name="view-name" value="selectedList" />
				</param>
				<param name="listener">
					<attribute name="class" value="SimpleDialogCloseListener" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="关闭" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="SimpleDialogCloseListener" />
				</param>
			</param>
			<property name="CommodityForm" class="CommodityForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="CommodityQuery.selectedList"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
		</view>
		<view name="Change" builder="EditViewBuilder">
			<param name="note">
				<attribute name="former" value="noteFormer4Order" />
			</param>
			<property name="changeList" label="更改单据选项" builder="CheckBoxGroupBuilder" >
				<param name="cfg">
					<attribute name="position" value="row"/>
				</param>
				<param name="options">
					<attribute name="collection" value="getChangeOptions"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ChangeAssociateListener"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="setter" value="resetChangeList"/>
				</param>
			</property>
			<property name="orderFirst" class="OrderDetail" builder="ChangeViewBuilder">
				<property name="ArrangeTicket.Ticket" class="ArrangeTicket"/>
				<property name="client" class="Client"/>
				<property name="subCompany" class="SubCompany"/>
				<property name="OrderTicket.Ticket" class="OrderTicket" />
				<property name="uorder" label="订单人" builder="TextBuilder"/>
			</property>
			<property name="orderFirst.changeRemark" label="改单申请备注" builder="TextAreaBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
				<param name="validate">
					<attribute name="require" value="true" />
				</param>
			</property>
			<property name="orderList" class="OrderDetail" builder="ChangeListBuilder">
				<param name="cfg">
					<attribute name="freezable" value="false" />
				</param>
				<param name="menu">
					<attribute name="text" value="提交申请改单" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
						<attribute name="former" value="selectEdit4Order"/>
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="setChangeNotes" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="validateChangeApply" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener"/>
						<attribute name="method" value="selectFormer4Order.revalidate"/>
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="setter" value="setOrder4Service" />
						<param name="state">
							<attribute name="id" value="40" />
							<attribute name="name" value="申请改单" />
							<attribute name="method" value="setChangeState" />
						</param>
						<param name="user">
							<attribute name="method" value="setChangeUser" />
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="target" value="Change" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="删除申请改单" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="TerminateListener" />
						<attribute name="expression" value="orderFirst.stOrder=30 and orderFirst.arrangeId=30" />
						<attribute name="message" value="不通过的改单申请才能删除！" />
					</param>
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
						<attribute name="former" value="selectEdit4Order" />
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<attribute name="action" value="OrderTicket_ChangeClear" />
						<attribute name="setter" value="setChangeClear4Service" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="改单申请删除" />
							<attribute name="method" value="setChangeState" />
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="target" value="Change" />
					</param>
				</param>
				<property name="monthnum" label="月流水号" builder="TextBuilder"/>
				<property name="commodity" class="Commodity"/>
				<property name="amount" label="数量" builder="TextFieldBuilder"/>
				<property name="price" label="采购价" builder="TextFieldBuilder"/>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
			</property>
		</view>
		<view name="Adjust" builder="EditViewBuilder">
			<param name="note">
				<attribute name="type" value="has-note" />
				<attribute name="former" value="noteFormer4Order" />
			</param>
			<param name="menu">
				<attribute name="text" value="返回" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="attrMap.AdjustType" label="红冲单据" builder="RadioButtonGroupBuilder" >
				<param name="options">
					<attribute name="collection" value="getAdjustOptions"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ChangeAssociateListener"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="setter" value="resetAdjusting"/>
				</param>
			</property>
			<property name="orderFirst" class="OrderDetail" builder="ChangeViewBuilder">
				<property name="client" class="Client"/>
				<property name="subCompany" class="SubCompany"/>
				<property name="OrderTicket.Ticket" class="OrderTicket"/>
				<property name="uorder" label="订单人" builder="TextBuilder"/>
				<property name="uchange" label="红冲人" builder="TextBuilder"/>
				<property name="ArrangeTicket.Ticket" class="ArrangeTicket">
					<param name="note">
						<attribute name="type" value="only-note"/>
					</param>
					<property name="cancelType" label="原采购处理方式" builder="RadioButtonGroupBuilder" >
						<param name="options">
							<attribute name="collection" value="getArrangeOptions4Cancel"/>
						</param>
					</property>
				</property>
				<property name="ArrangeTicket.Ticket" class="ArrangeTicket">
					<property name="arrangeType" label="安排方式" builder="TextFieldBuilder" />
					<property name="deliverNote" label="安排发货备注" builder="TextFieldBuilder" >
						<param name="cfg">
							<attribute name="columns" value="3"/>
						</param>
					</property>
				</property>
			</property>
			<property name="orderFirst.changeRemark" label="红冲备注" builder="TextAreaBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
			</property>
			<property name="orderList" class="OrderDetail" builder="ChangeListBuilder">
				<param name="menu">
					<attribute name="text" value="红冲通过" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="setChangeNotes" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="validateAdjustYes" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener"/>
						<attribute name="method" value="selectFormer4Order.revalidate"/>
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<param name="action">
							<attribute name="action" value="OrderTicket_AdjustEffect" />
							<attribute name="setter" value="setAdjust4Service" />
							<attribute name="expression" value="AdjustType='订单'" />
							<attribute name="message" value="采购处理订单红冲为通过" />
							<param name="state">
								<attribute name="id" value="30" />
								<attribute name="name" value="订单红冲通过" />
								<attribute name="method" value="setOrderState" />
								<attribute name="select" value="amount>0" />
							</param>
							<param name="state">
								<attribute name="id" value="0" />
								<attribute name="name" value="订单红冲通过数量改为0" />
								<attribute name="method" value="setOrderState" />
								<attribute name="select" value="amount=0" />
							</param>
						</param>
						<param name="action">
							<attribute name="action" value="OrderTicket_AdjustEffect" />
							<attribute name="setter" value="setAdjust4Service" />
							<attribute name="expression" value="AdjustType='排单'" />
							<attribute name="message" value="采购处理排单红冲为通过" />
							<param name="state">
								<attribute name="id" value="30" />
								<attribute name="name" value="排单红冲通过" />
								<attribute name="method" value="setArrangeState" />
							</param>
						</param>
						<param name="action">
							<attribute name="action" value="OrderTicket_Effect" />
							<attribute name="setter" value="setAdjust4Service" />
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<attribute name="type" value="UnTransaction" />
						<param name="action">
							<attribute name="action" value="OrderTicket_Count" />
							<attribute name="property" value="SelectFormer4Order.selectedList" />
							<attribute name="message" value="订单全单统计" />
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="target" value="Adjust" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="不通过驳回红冲" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="setChangeNotes" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="validateAdjustNo" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener"/>
						<attribute name="method" value="selectFormer4Order.revalidate"/>
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<param name="action">
							<attribute name="action" value="OrderTicket_Save" />
							<attribute name="setter" value="setAdjust4Service" />
							<attribute name="expression" value="AdjustType='订单'" />
							<param name="state">
								<attribute name="id" value="52" />
								<attribute name="name" value="红冲不通过驳回" />
								<attribute name="method" value="setOrderState" />
							</param>
						</param>
						<param name="action">
							<attribute name="action" value="OrderTicket_Save" />
							<attribute name="setter" value="setAdjust4Service" />
							<attribute name="expression" value="AdjustType='排单'" />
							<param name="state">
								<attribute name="id" value="52" />
								<attribute name="name" value="红冲不通过驳回" />
								<attribute name="method" value="setArrangeState" />
							</param>
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="target" value="Adjust" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="转交排单处理" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="setChangeNotes" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="validateAdjust2Arrange" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener"/>
						<attribute name="method" value="selectFormer4Order.revalidate"/>
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="setter" value="setAdjust4Service" />
						<attribute name="message" value="采购将订单红冲转交排单处理" />
						<param name="state">
							<attribute name="id" value="53" />
							<attribute name="name" value="订单红冲转交排单处理" />
							<attribute name="method" value="setOrderState" />
						</param>
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="method" value="setArrangeState" />
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="target" value="Adjust" />
					</param>
				</param>
				<property name="monthnum" label="月流水号" builder="TextBuilder"/>
				<property name="commodity" class="Commodity"/>
				<property name="amount" label="数量" builder="TextFieldBuilder"/>
				<property name="price" label="单价" builder="TextFieldBuilder"/>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
			</property>
		</view>
		<view name="Purchase" builder="EditViewBuilder">
			<property name="domain" class="OrderDetail">
				<property name="supplier" class="Supplier"/>
				<property name="PurchaseTicket.Ticket" class="PurchaseTicket"/>
				<property name="ArrangeTicket.Ticket" class="ArrangeTicket" builder="AuditViewBuilder"/>
			</property>
			<property name="detailList" class="OrderDetail" builder="EditListBuilder">
				<param name="menu">
					<attribute name="text" value="移除明细" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDeleteListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="expression" value="detailList.size=0" />
						<attribute name="target" value="Purchase" />
					</param>
				</param>
				<property name="monthnum" label="月流水号" builder="TextBuilder"/>
				<property name="commodity" class="Commodity" builder="AuditListBuilder"/>
				<property name="amount" label="数量" builder="TextBuilder">
					<param name="footer">
						<attribute name="type" value="SUM" />
						<attribute name="expression" value="sum(amount)" />
					</param>
				</property>
				<property name="price" label="采购价" builder="TextFieldBuilder">
					<param name="validate">
						<attribute name="require" value="true" />
						<attribute name="validate"><![CDATA[eval(this.value)>0]]></attribute>
						<attribute name="message" value="单价要大于0" />
						<attribute name="setter"><![CDATA[[{$PurchaseTicket.pmoney}]]]></attribute>
					</param>
				</property>
	        	<property name="PurchaseTicket.pmoney" label="采购合价" builder="TextFieldBuilder">
					<param name="cfg">
						<attribute name="editable" value="false" />
					</param>
					<param name="validate">
						<attribute name="getter"><![CDATA[
var tprice={$price}.svalue, tamount={$amount}.svalue;
if (tprice.length>0 && tamount.length>0) {
	this.value=eval(tprice) * eval(tamount);
} else {
	this.value=null;
}
this.onblur();
						]]></attribute>
					</param>
	        	</property>
				<property name="commodity.price" label="商品基准价格" builder="TextBuilder"/>
				<property name="PurchaseTicket.Detail" class="PurchaseTicket"/>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
				<property name="OrderTicket.number" label="订单号" builder="TextBuilder"/>
				<property name="OrderTicket.Detail" class="OrderTicket" />
				<property name="voParamMap.ClientT.Trunk" label="客户" builder="TextBuilder"/>
				<property name="voParamMap.SubCompanyT.Trunk" label="分公司" builder="TextBuilder"/>
			</property>
		</view>
		<view name="Common" builder="EditViewBuilder">
			<param name="note">
				<attribute name="type" value="hidden" />
			</param>
			<param name="menu">
				<attribute name="text" value="提交" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ValidateListener"/>
					<attribute name="method" value="validatePurchase"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Order.revalidate"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="message" value="Client链接供应商家gen客户订单" />
						<attribute name="setter" value="setOrderLink4Service" />
						<attribute name="expression" value="domain.supplier.toSellerId>0 and domain.supplier.toSellerId!=sellerId" />
						<param name="state">
							<attribute name="id" value="20" />
							<attribute name="name" value="客户递交订单" />
							<attribute name="method" value="setOrderState" />
						</param>
						<param name="user">
							<attribute name="method" value="setOrderUser" />
						</param>
						<param name="before">
							<attribute name="method" value="OrderLink.actionBefore" />
						</param>
						<param name="after">
							<attribute name="method" value="ActionService4LinkListener.actionAfter" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Save" />
						<attribute name="message" value="普通采购开单" />
						<attribute name="setter" value="setPurchase4Service" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="采购开单" />
							<attribute name="method" value="setPurchaseState" />
						</param>
						<param name="state">
							<attribute name="id" value="10" />
							<attribute name="name" value="采购开单" />
							<attribute name="method" value="setSendState" />
						</param>
						<param name="user">
							<attribute name="method" value="setPurchaseUser" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Effect" />
						<attribute name="message" value="重计算够用库存量" />
						<attribute name="setter" value="setPurchaseEffect4Service" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Count" />
						<attribute name="property" value="SelectFormer4Order.selectedList" />
						<attribute name="message" value="订单全单统计" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="返回" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="SelfForm" class="PurchaseTicketForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="Purchase"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
		</view>
		<view name="BomPurchase" builder="EditViewBuilder">
			<param name="note">
				<attribute name="type" value="hidden" />
			</param>
			<param name="menu">
				<attribute name="text" value="提交" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ValidateListener"/>
					<attribute name="method" value="validatePurchase"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Bom.revalidate"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="message" value="原物料采购开单" />
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Save" />
						<attribute name="message" value="原物料普通采购开单" />
						<attribute name="setter" value="setPurchase4Service" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="原物料采购开单" />
							<attribute name="method" value="setPurchaseState" />
						</param>
						<param name="user">
							<attribute name="method" value="setPurchaseUser" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="BomTicket_Save" />
						<attribute name="message" value="原物料请购普通采购开单,有采购名" />
						<attribute name="setter" value="setBomPurchase4Service" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="原物料采购开单" />
							<attribute name="method" value="setBomPurchaseState" />
						</param>
						<param name="user">
							<attribute name="method" value="setBomPurchaseUser" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="BomTicket_Save" />
						<attribute name="message" value="加工的原物料有使用供应商" />
						<attribute name="setter" value="setBomSupplier4Service" />
					</param>
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Effect" />
						<attribute name="message" value="重计算够用库存量" />
						<attribute name="setter" value="setPurchaseEffect4Service" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="返回" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="domain" class="OrderDetail">
				<property name="supplier" class="Supplier"/>
				<property name="PurchaseTicket.Ticket" class="PurchaseTicket"/>
				<property name="ArrangeTicket" class="ArrangeTicket" builder="AuditViewBuilder"/>
			</property>
			<property name="detailList" class="OrderDetail" builder="EditListBuilder">
				<param name="menu">
					<attribute name="text" value="移除明细" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDeleteListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="expression" value="bomList.size=0" />
						<attribute name="target" value="BomPurchase" />
					</param>
				</param>
				<property name="monthnum" label="月流水号" builder="TextBuilder"/>
				<property name="commodity" class="Commodity" builder="AuditListBuilder"/>
				<property name="amount" label="数量" builder="TextBuilder">
					<param name="footer">
						<attribute name="type" value="SUM" />
						<attribute name="expression" value="sum(amount)" />
					</param>
				</property>
				<property name="price" label="采购价" builder="TextFieldBuilder">
					<param name="validate">
						<attribute name="require" value="true" />
						<attribute name="validate"><![CDATA[eval(this.value)>0]]></attribute>
						<attribute name="message" value="单价要大于0" />
						<attribute name="setter"><![CDATA[[{$PurchaseTicket.pmoney}]]]></attribute>
					</param>
				</property>
	        	<property name="PurchaseTicket.pmoney" label="采购合价" builder="TextFieldBuilder">
					<param name="cfg">
						<attribute name="editable" value="false" />
					</param>
					<param name="validate">
						<attribute name="getter"><![CDATA[
var tprice={$price}.svalue, tamount={$amount}.svalue;
if (tprice.length>0 && tamount.length>0) {
	this.value=eval(tprice) * eval(tamount);
} else {
	this.value=null;
}
this.onblur();
						]]></attribute>
					</param>
	        	</property>
				<property name="PurchaseTicket.Detail" class="PurchaseTicket"/>
				<property name="OrderTicket.number" label="订单号" builder="TextBuilder"/>
				<property name="voParamMap.ClientT.Trunk" label="客户" builder="TextBuilder"/>
				<property name="voParamMap.SubCompanyT.Trunk" label="分公司" builder="TextBuilder"/>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
			</property>
		</view>
		<view name="Direct" builder="EditViewBuilder">
			<param name="note">
				<attribute name="type" value="hidden" />
			</param>
			<param name="menu">
				<attribute name="text" value="提交" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ValidateListener"/>
					<attribute name="method" value="validatePurchase"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Order.revalidate"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Save" />
						<attribute name="message" value="直发采购开单" />
						<attribute name="setter" value="setPurchase4Service" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="直发采购开单" />
							<attribute name="method" value="setPurchaseState" />
						</param>
						<param name="state">
							<attribute name="id" value="10" />
							<attribute name="name" value="直发采购开单" />
							<attribute name="method" value="setSendState" />
						</param>
						<param name="user">
							<attribute name="method" value="setPurchaseUser" />
						</param>
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Count" />
						<attribute name="property" value="SelectFormer4Order.selectedList" />
						<attribute name="message" value="订单全单统计" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="返回" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="SelfForm" class="PurchaseTicketForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="Purchase"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
		</view>
		<view name="Local" label0="当地购开单" builder="EditViewBuilder">
			<param name="note">
				<attribute name="former" value="noteFormer4Purchase" />
				<attribute name="type" value="has-note" />
			</param>
			<param name="menu">
				<attribute name="text" value="提交" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ValidateListener"/>
					<attribute name="method" value="validatePurchase"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Purchase.revalidate"/>
					<attribute name="expression"><![CDATA[selectFormer4Purchase.SelectedList.size>0 and selectFormer4Purchase.First.id=domain.SnapShot.id]]></attribute>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Order.revalidate"/>
					<attribute name="expression"><![CDATA[selectFormer4Order.SelectedList.size>0 and selectFormer4Order.First.id=domain.SnapShot.id]]></attribute>
				</param>
<!-- 有下级，开单要上级审核 -->
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="message" value="当地购采购开单" />
					<attribute name="expression"><![CDATA[DetailFirstOrder.Client.fromSellerId=sellerId ]]></attribute>
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Save" />
						<attribute name="setter" value="setPurchase4Service" />
						<param name="state">
							<attribute name="id" value="20" />
							<attribute name="name" value="当地购开单" />
							<attribute name="method" value="setPurchaseState" />
						</param>
						<param name="user">
							<attribute name="method" value="setPurchaseUser" />
						</param>
						<param name="before">
							<attribute name="method" value="DetailOrderLink.actionBefore" />
						</param>
						<param name="after">
							<attribute name="method" value="ActionService4LinkListener.actionAfter" />
						</param>
					</param>
				</param>
<!-- 没有下级，开单立即生效 -->
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="message" value="当地购单开单立即生效" />
					<attribute name="expression"><![CDATA[DetailFirstOrder.Client.fromSellerId=0]]></attribute>
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Save" />
						<attribute name="setter" value="setPurchase4Service" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="当地购开单生效" />
							<attribute name="method" value="setPurchaseState" />
						</param>
						<param name="state">
							<attribute name="id" value="10" />
							<attribute name="name" value="当地购开单" />
							<attribute name="method" value="setSendState" />
						</param>
						<param name="user">
							<attribute name="method" value="setPurchaseUser" />
						</param>
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Count" />
						<attribute name="property" value="DetailList" />
						<attribute name="message" value="订单全单统计" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="返回" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="domain" class="OrderDetail" builder="EditViewBuilder"/>
			<property name="domain.changeRemark" label="不通过原因" builder="TextAreaBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
			</property>
			<property name="detailList" class="OrderDetail" builder="EditListBuilder"/>
		</view>
		<view name="LocalAudit" label0="当地购审核" builder="EditViewBuilder">
			<param name="note">
				<attribute name="former" value="noteFormer4Purchase" />
			</param>
			<param name="menu">
				<attribute name="text" value="清空审核备注" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="RefreshListener"/>
					<attribute name="before" value="setPurchaseNotesClear"/>
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="通过" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="setter" value="setPurchaseChangeNotes"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ValidateListener"/>
					<attribute name="method" value="validateLocalYes"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Purchase.revalidate"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="message" value="当地购单审核通过，生效" />
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Save" />
						<attribute name="setter" value="setPurchase4Service" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="当地购开单" />
							<attribute name="method" value="setPurchaseState" />
						</param>
						<param name="state">
							<attribute name="id" value="10" />
							<attribute name="name" value="当地购开单" />
							<attribute name="method" value="setSendState" />
						</param>
						<param name="user">
							<attribute name="method" value="setPurchaseUser" />
						</param>
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Count" />
						<attribute name="property" value="SelectFormer4Purchase.selectedList" />
						<attribute name="message" value="订单全单统计" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="不通过" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="setter" value="setPurchaseChangeNotes"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ValidateListener"/>
					<attribute name="method" value="validateLocalNo"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Purchase.revalidate"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="message" value="当地购单不通过，返回给开单人" />
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Save" />
						<attribute name="setter" value="setPurchase4Service" />
						<param name="state">
							<attribute name="id" value="10" />
							<attribute name="name" value="当地购开单" />
							<attribute name="method" value="setPurchaseState" />
						</param>
						<param name="user">
							<attribute name="method" value="setPurchaseUser" />
						</param>
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="返回" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="domain" class="OrderDetail" builder="ChangeViewBuilder"/>
			<property name="domain.changeRemark" label="不通过原因" builder="TextAreaBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
			</property>
			<property name="detailList" class="OrderDetail" builder="ChangeListBuilder"/>
		</view>
		<view name="Reedit" builder="EditViewBuilder">
			<param name="note">
				<attribute name="type" value="hidden" />
				<attribute name="former" value="noteFormer4Purchase" />
			</param>
			<param name="menu">
				<attribute name="text" value="提交" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ValidateListener"/>
					<attribute name="method" value="validatePurchase"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Purchase.revalidate"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Save" />
						<attribute name="message" value="采购单重编辑" />
						<attribute name="setter" value="setReedit4Service" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="type" value="UnTransaction" />
					<param name="action">
						<attribute name="action" value="OrderTicket_Count" />
						<attribute name="property" value="SelectFormer4Purchase.selectedList" />
						<attribute name="message" value="订单全单统计" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="返回" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="SelfForm" class="PurchaseTicketForm" builder="ViewFieldBuilder">
				<param name="cfg">
					<attribute name="view-name" value="Purchase"/>
					<attribute name="position" value="row"/>
				</param>
			</property>
		</view>
		<view name="Repurchase" builder="EditViewBuilder">
			<param name="note">
				<attribute name="former" value="noteFormer4Purchase" />
				<attribute name="type" value="has-note" />
			</param>
			<param name="menu">
				<attribute name="text" value="返回" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="domain" class="OrderDetail">
				<property name="ArrangeTicket.Ticket" class="ArrangeTicket" builder="ChangeViewBuilder">
					<param name="note">
						<attribute name="type" value="show" />
					</param>
				</property>
			</property>
			<property name="domain" class="OrderDetail" builder="AuditViewBuilder">
				<property name="supplier" class="Supplier"/>
				<property name="PurchaseTicket.Ticket" class="PurchaseTicket"/>
				<property name="OrderTicket.Ticket" class="OrderTicket" />
			</property>
			<property name="domain.changeRemark" label="改单备注" builder="TextAreaBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
			</property>
			<property name="detailList" class="OrderDetail" builder="ChangeListBuilder">
				<param name="menu">
					<attribute name="text" value="订单改单申请" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="setPurchaseChangeNotes" />
					</param>
					<param name="listener">
						<attribute name="class" value="ValidateListener" />
						<attribute name="method" value="validateRepurchaseOrder" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="selectFormer4Purchase.revalidate" />
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<attribute name="message" value="发起订单改单申请，采购停止" />
						<param name="action">
							<attribute name="action" value="OrderTicket_Save" />
							<attribute name="message" value="上级供应商改单，订单改单，采购停止" />
							<attribute name="setter" value="setRepurchaseChangeOrder4Service" />
							<param name="state">
								<attribute name="id" value="40" />
								<attribute name="method" value="setOrderState" />
							</param>
							<param name="state">
								<attribute name="id" value="0" />
								<attribute name="method" value="setPurchaseState" />
							</param>
							<param name="state">
								<attribute name="id" value="0" />
								<attribute name="name" value="上级供应商改单，订单改单，采购停止" />
								<attribute name="method" value="setSendState" />
							</param>
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="ChangeAssociateListener" />
						<attribute name="method" value="setRemoveSelected" />
						<attribute name="property" value="detailList" />
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="target" value="Repurchase" />
						<attribute name="expression" value="detailList.size=0" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="排单改单申请" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="setPurchaseChangeNotes" />
					</param>
					<param name="listener">
						<attribute name="class" value="ValidateListener" />
						<attribute name="method" value="validateRepurchaseArrange" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="selectFormer4Purchase.revalidate" />
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<attribute name="message" value="发起排单改单申请，采购停止" />
						<param name="action">
							<attribute name="action" value="OrderTicket_Save" />
							<attribute name="message" value="上级供应商改单，排单改单，采购停止" />
							<attribute name="setter" value="setRepurchaseChangeArrange4Service" />
							<param name="state">
								<attribute name="id" value="40" />
								<attribute name="method" value="setArrangeState" />
							</param>
							<param name="state">
								<attribute name="id" value="0" />
								<attribute name="method" value="setPurchaseState" />
							</param>
							<param name="state">
								<attribute name="id" value="0" />
								<attribute name="name" value="上级供应商改单，排单改单，采购停止" />
								<attribute name="method" value="setSendState" />
							</param>
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="ChangeAssociateListener" />
						<attribute name="method" value="setRemoveSelected" />
						<attribute name="property" value="detailList" />
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="target" value="Repurchase" />
						<attribute name="expression" value="detailList.size=0" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="继续采购" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="ValidateListener" />
						<attribute name="method" value="validateRepurchasePurchase" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="selectFormer4Purchase.revalidate" />
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<attribute name="message" value="无改单申请继续商家采购" />
						<param name="action">
							<attribute name="action" value="PurchaseTicket_Save" />
							<attribute name="setter" value="setRepurchasePurchase4Service" />
							<param name="state">
								<attribute name="id" value="30" />
								<attribute name="name" value="重提交商家采购" />
								<attribute name="method" value="setPurchaseState" />
							</param>
						</param>
						<param name="action">
							<attribute name="action" value="OrderTicket_Save" />
							<attribute name="message" value="重生成链接商家客户订单" />
							<attribute name="setter" value="setOrderReLink4Service" />
							<attribute name="expression" value="domain.supplier.uaccept!=null" />
							<param name="state">
								<attribute name="id" value="20" />
								<attribute name="name" value="客户重递交订单" />
								<attribute name="method" value="setOrderState" />
							</param>
							<param name="user">
								<attribute name="method" value="setOrderUser" />
							</param>
							<param name="before">
								<attribute name="method" value="OrderLink.actionBefore" />
							</param>
							<param name="after">
								<attribute name="method" value="ActionService4LinkListener.actionAfter" />
							</param>
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<attribute name="type" value="UnTransaction" />
						<param name="action">
							<attribute name="action" value="OrderTicket_Count" />
							<attribute name="property" value="SelectFormer4Purchase.selectedList" />
							<attribute name="message" value="订单全单统计" />
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="ChangeAssociateListener" />
						<attribute name="method" value="setRemoveSelected" />
						<attribute name="property" value="detailList" />
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="target" value="Repurchase" />
						<attribute name="expression" value="detailList.size=0" />
					</param>
				</param>
				<property name="monthnum" label="月流水号" builder="TextBuilder"/>
				<property name="commodity" class="Commodity"/>
				<property name="amount" label="数量" builder="TextBuilder"/>
				<property name="price" label="采购价" builder="TextFieldBuilder">
					<param name="validate">
						<attribute name="require" value="true" />
						<attribute name="validate"><![CDATA[eval(this.value)>0]]></attribute>
						<attribute name="message" value="单价要大于0" />
					</param>
				</property>
				<property name="PurchaseTicket.Detail" class="PurchaseTicket"/>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
				<property name="OrderTicket.number" label="订单号" builder="TextBuilder"/>
				<property name="voParamMap.ClientT.Trunk" label="客户" builder="TextBuilder"/>
				<property name="voParamMap.SubCompanyT.Trunk" label="分公司" builder="TextBuilder"/>
				<property name="uorder" label="订单人" builder="TextBuilder"/>
			</property>
		</view>
		<view name="Rechange" builder="ChangeViewBuilder">
			<param name="note">
				<attribute name="former" value="noteFormer4Purchase" />
				<attribute name="type" value="has-note" />
			</param>
			<param name="menu">
				<attribute name="text" value="拒绝收货" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="setter" value="setPurchaseChangeNotes"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="setPurchaseChangeReceipt"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ValidateListener"/>
					<attribute name="method" value="validateRechangeNo"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Purchase.revalidate"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="action" value="PurchaseTicket_Save" />
					<attribute name="setter" value="setRechangePurchase4Service" />
					<attribute name="message" value="供应商发货错误，拒绝收货将货物退回给供应商？" />
					<param name="state">
						<attribute name="id" value="30" />
						<attribute name="name" value="拒绝收货" />
						<attribute name="method" value="setPurchaseState" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="提交改单处理" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="setter" value="setPurchaseChangeNotes"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="setPurchaseChangeReceipt"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ValidateListener"/>
					<attribute name="method" value="validateRechangeYes"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener"/>
					<attribute name="method" value="selectFormer4Purchase.revalidate"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="action" value="OrderTicket_Save" />
					<attribute name="message0" value="Client链接供应商家change客户订单，准备开红冲申请草稿，验证" />
					<attribute name="setter" value="setRechangeLink4Service_validate" />
					<attribute name="type" value="UnTransaction" />
					<param name="expression">
						<attribute name="expression" value="supplier.toSellerId>0 and supplier.toSellerId!=sellerId" />
						<attribute name="property" value="selectFormer4Purchase.First"/>
					</param>
					<param name="before">
						<attribute name="method" value="OrderLink.actionBefore" />
					</param>
					<param name="after">
						<attribute name="method" value="ActionService4LinkListener.actionAfter" />
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<param name="action">
						<attribute name="action" value="PurchaseTicket_ChangeEffect" />
						<attribute name="setter" value="setRechangePurchase4Service" />
						<attribute name="expression" value="Rechange2PurchaseAgree=true" />
						<attribute name="message" value="收货改单申请，采购同意更改的内容" />
					</param>
					<param name="action">
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="message" value="Client链接供应商家change客户订单，开红冲申请草稿" />
						<attribute name="setter" value="setRechangeLink4Service" />
						<param name="expression">
							<attribute name="expression" value="supplier.toSellerId>0 and supplier.toSellerId!=sellerId" />
							<attribute name="property" value="selectFormer4Purchase.First"/>
						</param>
						<param name="before">
							<attribute name="method" value="OrderLink.actionBefore" />
						</param>
						<param name="after">
							<attribute name="method" value="ActionService4LinkListener.actionAfter" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="OrderTicket_Save" />
						<attribute name="setter" value="setRechangeOrder4Service" />
						<attribute name="message" value="收货改单申请，采购处理转交" />
						<param name="state">
							<attribute name="id" value="43" />
							<attribute name="name" value="采购转交排单处理" />
							<attribute name="method" value="setArrangeState" />
							<attribute name="expression" value="Rechange2Arrange=true" />
						</param>
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="method" value="setArrangeState" />
							<attribute name="expression" value="Rechange2Arrange=false" />
						</param>
						<param name="state">
							<attribute name="id" value="43" />
							<attribute name="name" value="采购转交订单处理" />
							<attribute name="method" value="setOrderState" />
							<attribute name="expression" value="Rechange2Order=true" />
						</param>
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="method" value="setOrderState" />
							<attribute name="expression" value="Rechange2Order=false" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="PurchaseTicket_Save" />
						<attribute name="setter" value="setRechangeReceipt4Service" />
						<attribute name="message" value="收货改单申请，采购处理完成" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="method" value="setPurchaseState" />
						</param>
						<param name="state">
							<attribute name="name" value="转交收货处理" />
							<attribute name="expression" value="Rechange2Receipt=true" />
							<attribute name="method" value="setReceiptState" />
						</param>
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="返回" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="domain" class="OrderDetail">
				<param name="note">
					<attribute name="type" value="only-note" />
				</param>
				<property name="voParamMap.PurchaseAgree" label="采购同意改单项" builder="CheckBoxGroupBuilder">
					<param name="options">
						<attribute name="collection" value="getPurchaseAgreeOptions"/>
						<attribute name="value-property" value="key"/>
						<attribute name="text-property" value="value"/>
					</param>
				</property>
				<property name="voParamMap.OrderAgree" label="订单改单申请项" builder="CheckBoxGroupBuilder">
					<param name="cfg">
						<attribute name="position" value="row-right" />
					</param>
					<param name="options">
						<attribute name="collection" value="getOrderAgreeOptions"/>
						<attribute name="value-property" value="key"/>
						<attribute name="text-property" value="value"/>
					</param>
				</property>
				<property name="ReceiptTicket.Handle" label="收货改单申请项" class="ReceiptTicket" builder="ChangeListBuilder">
					<param name="cfg">
						<attribute name="type" value="inner" />
						<attribute name="position" value="inner" />
					</param>
					<param name="note">
						<attribute name="type" value="default" />
					</param>
					<property name="receiptAmount" label="到货数量" builder="TextFieldBuilder"/>
					<property name="badAmount" label="其中次品数" builder="TextFieldBuilder"/>
				</property>
			</property>
			<property name="domain" label="排单改单申请项" class="OrderDetail" builder="ChangeListBuilder">
				<param name="note">
					<attribute name="type" value="show" />
				</param>
				<param name="cfg">
					<attribute name="type" value="inner" />
					<attribute name="position" value="row-right" />
				</param>
				<property name="amount" label="订单采购数量" builder="TextFieldBuilder">
					<param name="listener">
						<attribute name="class" value="RefreshListener" />
						<attribute name="view-name" value="Rechange" />
					</param>
				</property>
				<property name="PurchaseTicket.Handle" label="排单改单申请项" class="PurchaseTicket" builder="EditListBuilder">
					<property name="backupAmount" label="转备料数量" builder="TextFieldBuilder">
						<param name="validate">
							<attribute name="validate"><![CDATA[isBlank(this.value) || eval(this.value)>0]]></attribute>
							<attribute name="message" value="数量要大于0" />
						</param>
					</property>
					<property name="cancelAmount" label="取消数量" builder="TextFieldBuilder">
						<param name="validate">
							<attribute name="validate"><![CDATA[isBlank(this.value) || eval(this.value)>0]]></attribute>
							<attribute name="message" value="数量要大于0" />
						</param>
					</property>
					<property name="rearrangeAmount" label="重排单数量" builder="TextFieldBuilder">
						<param name="validate">
							<attribute name="validate"><![CDATA[isBlank(this.value) || eval(this.value)>0]]></attribute>
							<attribute name="message" value="数量要大于0" />
						</param>
					</property>
					<property name="overAmount" label="多收货数量" builder="TextFieldBuilder">
						<param name="validate">
							<attribute name="validate"><![CDATA[isBlank(this.value) || eval(this.value)>0]]></attribute>
							<attribute name="message" value="数量要大于0" />
						</param>
					</property>
				</property>
			</property>
			<property name="domain" class="OrderDetail" builder="EditViewBuilder">
				<property name="changeRemark" label="改单申请原因" builder="TextAreaBuilder">
					<param name="cfg">
						<attribute name="position" value="row" />
					</param>
				</property>
			</property>
			<property name="domain" class="OrderDetail">
				<property name="ReceiptTicket.Ticket" class="ReceiptTicket"/>
				<property name="PurchaseTicket.Ticket" class="PurchaseTicket"/>
				<property name="supplier" class="Supplier"/>
				<property name="upurchase" label="采购人" builder="TextBuilder"/>
				<property name="uchange" label="收货改单人" builder="TextBuilder"/>
			</property>
			<property name="detailList" class="OrderDetail" label="明细列表" builder="ChangeListBuilder"/>
		</view>
		<view name="Show" builder="AuditViewBuilder">
			<param name="note">
				<attribute name="former" value="noteFormer4Purchase" />
				<attribute name="type" value="hidden" />
			</param>
			<param name="menu">
				<attribute name="text" value="返回" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="domain" class="OrderDetail">
				<property name="ReceiptTicket.Ticket" class="ReceiptTicket"/>
				<property name="PurchaseTicket.Ticket" class="PurchaseTicket"/>
				<property name="supplier" class="Supplier"/>
				<property name="upurchase" label="采购人" builder="TextBuilder"/>
			</property>
			<property name="detailList" class="OrderDetail" label="明细" builder="AuditListBuilder">
				<property name="monthnum" label="月流水号" builder="TextBuilder"/>
				<property name="commodity" class="Commodity"/>
				<property name="amount" label="数量" builder="TextBuilder"/>
				<property name="price" label="单价" builder="TextFieldBuilder">
					<param name="validate">
						<attribute name="require" value="true" />
						<attribute name="validate"><![CDATA[eval(this.value)>0]]></attribute>
						<attribute name="message" value="单价要大于0" />
					</param>
				</property>
				<property name="PurchaseTicket.Detail" class="PurchaseTicket"/>
				<property name="OrderTicket.number" label="订单号" builder="TextBuilder"/>
				<property name="voParamMap.ClientT.Trunk" label="客户" builder="TextBuilder"/>
				<property name="voParamMap.SubCompanyT.Trunk" label="分公司" builder="TextBuilder"/>
				<property name="voParamMap.LocationT.Ticket" label="分账名称" builder="TextBuilder"/>
				<property name="OrderTicket.Detail" class="OrderTicket"/>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
			</property>
			<property name="detailList" class="OrderDetail" label="明细流程状态" builder="AuditListBuilder">
				<property name="SPurchase" label="采购名称" builder="TextBuilder"/>
				<property name="SReceipt" label="收货名称" builder="TextBuilder"/>
				<property name="SReturn" label="退货名称" builder="TextBuilder"/>
				<property name="SInstore" label="入库名称" builder="TextBuilder"/>
				<property name="SOrder" label="订单名称" builder="TextBuilder"/>
				<property name="SArrange" label="排单名称" builder="TextBuilder"/>
				<property name="SSend" label="发货名称" builder="TextBuilder"/>
				<property name="notes" label="改单内容" builder="TextBuilder"/>
				<property name="changeRemark" label="改单备注" builder="TextBuilder"/>
			</property>
			<property name="detailList" class="OrderDetail" label="流程日志" builder="AuditListBuilder">
				<property name="monthnum" label="月流水号" builder="TextBuilder"/>
				<property name="stateNotes" label="流程日志" builder="TextBuilder"/>
			</property>
		</view>
		<view name="Print" builder="AuditViewBuilder">
			<param name="cfg">
				<attribute name="freezable" value="false" />
				<attribute name="columns" value="4" />
			</param>
			<property name="domain" class="OrderDetail">
				<property name="PurchaseTicket.Ticket" class="PurchaseTicket"/>
				<property name="supplier" class="Supplier"/>
				<property name="upurchase" label="采购人" builder="TextBuilder"/>
			</property>
			<property name="detailList" label="明细" class="OrderDetail" builder="AuditListBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
				<property name="monthnum" label="月流水号" builder="TextBuilder"/>
				<property name="commodity" class="Commodity"/>
				<property name="amount" label="数量" builder="TextBuilder"/>
				<property name="price" label="采购价" builder="TextFieldBuilder">
					<param name="validate">
						<attribute name="require" value="true" />
						<attribute name="validate"><![CDATA[eval(this.value)>0]]></attribute>
						<attribute name="message" value="单价要大于0" />
					</param>
				</property>
				<property name="PurchaseTicket.pmoney" label="采购合价" builder="TextBuilder" >
					<param name="footer">
						<attribute name="type" value="SUM" />
						<attribute name="expression" value="sum(PurchaseTicket.pmoney)" />
					</param>
				</property>
				<property name="PurchaseTicket.Detail" class="PurchaseTicket"/>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
			</property>
		</view>
		<view name="Doadjust" builder="EditViewBuilder">
			<param name="note">
				<attribute name="former" value="noteFormer4Purchase" />
			</param>
			<param name="menu">
				<attribute name="text" value="返回" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ForwardListener" />
					<attribute name="getter" value="getForwardFromBuilder" />
				</param>
			</param>
			<property name="domain" class="OrderDetail" builder="ChangeViewBuilder">
				<property name="supplier" class="Supplier"/>
				<property name="PurchaseTicket.Ticket" class="PurchaseTicket"/>
			</property>
			<property name="domain.changeRemark" label="红冲备注" builder="TextAreaBuilder">
				<param name="cfg">
					<attribute name="position" value="row" />
				</param>
			</property>
			<property name="detailList" class="OrderDetail" builder="ChangeListBuilder">
				<param name="menu">
					<attribute name="text" value="提交红冲" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener"/>
						<attribute name="method" value="selectFormer4Purchase.revalidate"/>
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener"/>
						<attribute name="setter" value="setPurchaseChangeNotes"/>
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="method" value="validateDoadjust" />
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<attribute name="action" value="PurchaseTicket_Save" />
						<attribute name="setter" value="setDoadjust4Service" />
						<param name="state">
							<attribute name="id" value="50" />
							<attribute name="name" value="采购发起红冲" />
							<attribute name="method" value="setPurchaseState" />
						</param>
						<param name="user">
							<attribute name="method" value="setChangeUser4Pur" />
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="target" value="Doadjust" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="删除红冲申请" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDomainListener" />
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener"/>
						<attribute name="method" value="selectFormer4Purchase.revalidate"/>
					</param>
					<param name="listener">
						<attribute name="class" value="TerminateListener" />
						<attribute name="expression" value="selectedFirst4Purchase.stPurchase!=52" />
						<attribute name="message" value="不通过驳回的红冲申请才能删除！" />
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<attribute name="action" value="PurchaseTicket_AdjustDelete" />
						<attribute name="setter" value="setDoadjust4Service" />
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="采购红冲删除" />
							<attribute name="method" value="setPurchaseState" />
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="ActionServiceListener" />
						<attribute name="type" value="UnTransaction" />
						<param name="action">
							<attribute name="action" value="OrderTicket_Count" />
							<attribute name="property" value="SelectFormer4Purchase.selectedList" />
							<attribute name="message" value="订单全单统计" />
						</param>
					</param>
					<param name="listener">
						<attribute name="class" value="ForwardListener" />
						<attribute name="getter" value="getForwardFromBuilder" />
						<attribute name="target" value="Doadjust" />
					</param>
				</param>
			</property>
		</view>
		<view name="Import" builder="EditViewBuilder">
			<param name="cfg">
				<attribute name="menu" value="加载列配置" />
			</param>
			<param name="menu">
				<attribute name="text" value="导入提交" />
				<attribute name="image" value="mily/img/color.gif" />
				<param name="listener">
					<attribute name="class" value="ValidateListener" />
					<attribute name="setter" value="validateImport"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="method" value="setInExtra4Service" info="备货库存添加" />
				</param>
				<param name="listener">
					<attribute name="class" value="ActionServiceListener" />
					<attribute name="message" value="确认新增库存明细数量" />
					<param name="action">
						<attribute name="action" value="StoreTicket_Extra" />
						<attribute name="setter" value="setImportInstore4Service" />
						<attribute name="message" value="导入库存资料"/>
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="name" value="导入库存" />
							<attribute name="method" value="setReceiptState" />
						</param>
						<param name="state">
							<attribute name="id" value="30" />
							<attribute name="method" value="setPurchaseState" />
						</param>
						<param name="user">
							<attribute name="method" value="setReceiptUser" />
						</param>
					</param>
					<param name="action">
						<attribute name="action" value="ReceiptTicket_Effect"/>
						<attribute name="setter" value="setImportCount4Service"/>
						<attribute name="message" value="导入后重计算库存量"/>
					</param>
				</param>
				<param name="listener">
					<attribute name="class" value="RedirectorListener" />
					<attribute name="url" value="success.jsp"/>
				</param>
			</param>
			<param name="menu">
				<attribute name="text" value="加载列配置" />
				<attribute name="image" value="mily/img/color.gif" />
				<attribute name="show" value="false" />
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="setter" value="setImportLabelLoad"/>
				</param>
				<param name="listener">
					<attribute name="class" value="PostListener" />
					<attribute name="setter" value="BaseImportForm.getSellerIndexes"/>
				</param>
				<param name="listener">
					<attribute name="class" value="ChangeAssociateListener" />
					<attribute name="properties" value="commodity.supplyType"/>
				</param>
			</param>
			<property name="domain" class="OrderDetail">
				<param name="cfg">
					<attribute name="property" value="Self" />
				</param>
				<property name="commodity.supplyType" label="供货方式" builder="SelectListBuilder">
					<param name="options">
						<attribute name="type" value="SelectList"/>
						<attribute name="collection" value="getSupplyTypeOptions"/>
						<attribute name="value-property" value="name"/>
						<attribute name="text-property" value="name"/>
					</param>
				</property>
				<property name="voParamMap.Remark" label="单元格内容" builder="TextAreaBuilder">
					<param name="cfg">
						<attribute name="position" value="row" />
					</param>
				</property>
			</property>
			<property name="domain" label="标题行配置" class="OrderDetail" builder="EditListBuilder">
				<param name="menu">
					<attribute name="text" value="默认依次顺序" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="BaseImportForm.setImportIndexDefault" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="清空顺序" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="BaseImportForm.setImportIndexClear" />
					</param>
				</param>
				<param name="cfg">
					<attribute name="property" value="Choose-Edit" />
				</param>
				<property name="voParamMap.note" label="标题名" builder="TextBuilder"/>
				<property name="commodity" class="Commodity">
					<param name="cfg">
						<attribute name="exclude" value="supplyType" />
					</param>
				</property>
				<property name="price" label="入库价格" builder="TextFieldBuilder"/>
				<property name="amount" label="库存量" builder="TextFieldBuilder"/>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
			</property>
			<property name="importList" label="格式化整理" class="OrderDetail" builder="EditListBuilder">
				<param name="menu">
					<attribute name="text" value="删除行" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="SelectDeleteListener" />
					</param>
				</param>
				<param name="menu">
					<attribute name="text" value="导入格式化" />
					<attribute name="image" value="mily/img/color.gif" />
					<param name="listener">
						<attribute name="class" value="ValidateListener" />
						<attribute name="setter" value="validateToImport"/>
					</param>
					<param name="listener">
						<attribute name="class" value="PostListener" />
						<attribute name="setter" value="setImportFormated"/>
					</param>
					<param name="listener">
						<attribute name="class" value="RefreshListener" />
					</param>
				</param>
				<param name="cfg">
					<attribute name="property" value="Choose-Edit" />
				</param>
				<property name="commodity" class="Commodity">
					<param name="cfg">
						<attribute name="exclude" value="supplyType" />
					</param>
				</property>
				<property name="amount" label="库存量" builder="TextFieldBuilder"/>
				<property name="price" label="入库价格" builder="TextFieldBuilder"/>
				<property name="remark" label="明细备注" builder="TextFieldBuilder"/>
				<property name="commodity.voParamMap.error" label="导入行错误" builder="TextFieldBuilder"/>
			</property>
		</view>
	</class>
</mily-mappings>
